{"version":3,"sources":["../../../src/file-storage/services/storage-provider.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { IStorageProvider, FileUploadOptions, FileUploadResult, FileDownloadOptions, FileDownloadResult, SignedUrlOptions, FileMetadata, FileVersion } from '../interfaces/file-storage.interfaces';\nimport { S3StorageService } from '../providers/s3-storage.service';\nimport { LocalStorageService } from '../providers/local-storage.service';\n\n/**\n * Storage Provider Service\n *\n * Provides the appropriate storage provider based on configuration\n */\n@Injectable()\nexport class StorageProviderService {\n    private readonly logger = new Logger(StorageProviderService.name);\n    private provider: IStorageProvider;\n\n    constructor(\n        private readonly configService: ConfigService,\n        private readonly s3StorageService: S3StorageService,\n        private readonly localStorageService: LocalStorageService,\n    ) {\n        this.provider = this.getStorageService();\n        this.logger.log(`Storage provider initialized: ${this.getProviderType()}`);\n    }\n\n    /**\n     * Get the storage provider type\n     */\n    getProviderType(): string {\n        const provider = this.configService.get<string>('STORAGE_PROVIDER', 'local');\n        return provider;\n    }\n\n    /**\n     * Get the appropriate storage service\n     */\n    getStorageService(): IStorageProvider {\n        const provider = this.configService.get<string>('STORAGE_PROVIDER', 'local');\n\n        switch (provider) {\n            case 's3':\n                return this.s3StorageService;\n            case 'local':\n            default:\n                return this.localStorageService;\n        }\n    }\n\n    /**\n     * Upload a file\n     */\n    async upload(options: FileUploadOptions): Promise<FileUploadResult> {\n        return this.provider.upload(options);\n    }\n\n    /**\n     * Download a file\n     */\n    async download(options: FileDownloadOptions): Promise<FileDownloadResult> {\n        return this.provider.download(options);\n    }\n\n    /**\n     * Delete a file\n     */\n    async delete(path: string): Promise<void> {\n        return this.provider.delete(path);\n    }\n\n    /**\n     * Check if a file exists\n     */\n    async exists(path: string): Promise<boolean> {\n        return this.provider.exists(path);\n    }\n\n    /**\n     * Get file metadata\n     */\n    async getMetadata(path: string): Promise<FileMetadata> {\n        return this.provider.getMetadata(path);\n    }\n\n    /**\n     * Generate a signed URL\n     */\n    async generateSignedUrl(options: SignedUrlOptions): Promise<string> {\n        return this.provider.generateSignedUrl(options);\n    }\n\n    /**\n     * List file versions\n     */\n    async listVersions(path: string): Promise<FileVersion[]> {\n        return this.provider.listVersions(path);\n    }\n\n    /**\n     * Copy a file\n     */\n    async copy(sourcePath: string, destinationPath: string): Promise<FileUploadResult> {\n        return this.provider.copy(sourcePath, destinationPath);\n    }\n\n    /**\n     * Move a file\n     */\n    async move(sourcePath: string, destinationPath: string): Promise<FileUploadResult> {\n        return this.provider.move(sourcePath, destinationPath);\n    }\n\n    /**\n     * Delete multiple files\n     */\n    async deleteMultiple(paths: string[]): Promise<void> {\n        return this.provider.deleteMultiple(paths);\n    }\n\n    /**\n     * Get storage usage for a prefix\n     */\n    async getStorageUsage(prefix: string): Promise<number> {\n        return this.provider.getStorageUsage(prefix);\n    }\n}\n"],"names":["StorageProviderService","getProviderType","provider","configService","get","getStorageService","s3StorageService","localStorageService","upload","options","download","delete","path","exists","getMetadata","generateSignedUrl","listVersions","copy","sourcePath","destinationPath","move","deleteMultiple","paths","getStorageUsage","prefix","logger","Logger","name","log"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAZsB;wBACL;kCAEG;qCACG;;;;;;;;;;AAQ7B,IAAA,AAAMA,yBAAN,MAAMA;IAaT;;KAEC,GACDC,kBAA0B;QACtB,MAAMC,WAAW,IAAI,CAACC,aAAa,CAACC,GAAG,CAAS,oBAAoB;QACpE,OAAOF;IACX;IAEA;;KAEC,GACDG,oBAAsC;QAClC,MAAMH,WAAW,IAAI,CAACC,aAAa,CAACC,GAAG,CAAS,oBAAoB;QAEpE,OAAQF;YACJ,KAAK;gBACD,OAAO,IAAI,CAACI,gBAAgB;YAChC,KAAK;YACL;gBACI,OAAO,IAAI,CAACC,mBAAmB;QACvC;IACJ;IAEA;;KAEC,GACD,MAAMC,OAAOC,OAA0B,EAA6B;QAChE,OAAO,IAAI,CAACP,QAAQ,CAACM,MAAM,CAACC;IAChC;IAEA;;KAEC,GACD,MAAMC,SAASD,OAA4B,EAA+B;QACtE,OAAO,IAAI,CAACP,QAAQ,CAACQ,QAAQ,CAACD;IAClC;IAEA;;KAEC,GACD,MAAME,OAAOC,IAAY,EAAiB;QACtC,OAAO,IAAI,CAACV,QAAQ,CAACS,MAAM,CAACC;IAChC;IAEA;;KAEC,GACD,MAAMC,OAAOD,IAAY,EAAoB;QACzC,OAAO,IAAI,CAACV,QAAQ,CAACW,MAAM,CAACD;IAChC;IAEA;;KAEC,GACD,MAAME,YAAYF,IAAY,EAAyB;QACnD,OAAO,IAAI,CAACV,QAAQ,CAACY,WAAW,CAACF;IACrC;IAEA;;KAEC,GACD,MAAMG,kBAAkBN,OAAyB,EAAmB;QAChE,OAAO,IAAI,CAACP,QAAQ,CAACa,iBAAiB,CAACN;IAC3C;IAEA;;KAEC,GACD,MAAMO,aAAaJ,IAAY,EAA0B;QACrD,OAAO,IAAI,CAACV,QAAQ,CAACc,YAAY,CAACJ;IACtC;IAEA;;KAEC,GACD,MAAMK,KAAKC,UAAkB,EAAEC,eAAuB,EAA6B;QAC/E,OAAO,IAAI,CAACjB,QAAQ,CAACe,IAAI,CAACC,YAAYC;IAC1C;IAEA;;KAEC,GACD,MAAMC,KAAKF,UAAkB,EAAEC,eAAuB,EAA6B;QAC/E,OAAO,IAAI,CAACjB,QAAQ,CAACkB,IAAI,CAACF,YAAYC;IAC1C;IAEA;;KAEC,GACD,MAAME,eAAeC,KAAe,EAAiB;QACjD,OAAO,IAAI,CAACpB,QAAQ,CAACmB,cAAc,CAACC;IACxC;IAEA;;KAEC,GACD,MAAMC,gBAAgBC,MAAc,EAAmB;QACnD,OAAO,IAAI,CAACtB,QAAQ,CAACqB,eAAe,CAACC;IACzC;IA3GA,YACI,AAAiBrB,aAA4B,EAC7C,AAAiBG,gBAAkC,EACnD,AAAiBC,mBAAwC,CAC3D;aAHmBJ,gBAAAA;aACAG,mBAAAA;aACAC,sBAAAA;aANJkB,SAAS,IAAIC,cAAM,CAAC1B,uBAAuB2B,IAAI;QAQ5D,IAAI,CAACzB,QAAQ,GAAG,IAAI,CAACG,iBAAiB;QACtC,IAAI,CAACoB,MAAM,CAACG,GAAG,CAAC,CAAC,8BAA8B,EAAE,IAAI,CAAC3B,eAAe,IAAI;IAC7E;AAqGJ"}