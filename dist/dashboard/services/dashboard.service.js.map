{"version":3,"sources":["../../../src/dashboard/services/dashboard.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository, Between, MoreThan } from 'typeorm';\nimport { Case } from '../../database/entities/Case.entity';\nimport { Client } from '../../database/entities/Client.entity';\nimport { Event } from '../../database/entities/Event.entity';\nimport { AuditLog } from '../../database/entities/AuditLog.entity';\nimport { Invoice } from '../../database/entities/Invoice.entity';\nimport { AuditAction } from '../../database/entities/enums/subscription.enum';\nimport {\n    StatCardDto,\n    RecentCaseDto,\n    UpcomingEventDto,\n    ActivityFeedDto,\n    TaskDto,\n    RevenueDataPointDto,\n} from '../dto/dashboard-response.dto';\nimport { GetDashboardStatsDto } from '../dto/dashboard-stats.dto';\n\n@Injectable()\nexport class DashboardService {\n    constructor(\n        @InjectRepository(Case)\n        private caseRepository: Repository<Case>,\n        @InjectRepository(Client)\n        private clientRepository: Repository<Client>,\n        @InjectRepository(Event)\n        private eventRepository: Repository<Event>,\n        @InjectRepository(AuditLog)\n        private auditLogRepository: Repository<AuditLog>,\n        @InjectRepository(Invoice)\n        private invoiceRepository: Repository<Invoice>,\n    ) {}\n\n    /**\n     * Get dashboard statistics for a tenant\n     */\n    async getDashboardStats(\n        tenantId: string,\n        query: GetDashboardStatsDto,\n    ): Promise<{\n        stats: StatCardDto[];\n        recentCases: RecentCaseDto[];\n        upcomingEvents: UpcomingEventDto[];\n        activityFeed: ActivityFeedDto[];\n        pendingTasks: TaskDto[];\n        revenueData: RevenueDataPointDto[];\n    }> {\n        const { days = 30, startDate, endDate } = query;\n\n        // Calculate date range\n        const now = new Date();\n        const start = startDate ? new Date(startDate) : new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n        const end = endDate ? new Date(endDate) : now;\n\n        // Get previous period for comparison\n        const daysInMillis = end.getTime() - start.getTime();\n        const previousStart = new Date(start.getTime() - daysInMillis);\n        const previousEnd = new Date(end.getTime() - daysInMillis);\n\n        // Fetch data in parallel\n        const [\n            totalClients,\n            activeCases,\n            totalCases,\n            totalRevenue,\n            previousTotalRevenue,\n            recentCases,\n            upcomingEvents,\n            activityFeed,\n            invoicesByDate,\n        ] = await Promise.all([\n            // Total clients\n            this.clientRepository.count({\n                where: { tenantId, status: 'active', deletedAt: null as any },\n            }),\n            // Active cases\n            this.caseRepository.count({\n                where: { tenantId, status: 'active', deletedAt: null as any },\n            }),\n            // Total cases\n            this.caseRepository.count({\n                where: { tenantId, deletedAt: null as any },\n            }),\n            // Total revenue in current period\n            this.invoiceRepository\n                .createQueryBuilder('invoice')\n                .select('COALESCE(SUM(invoice.totalAmount), 0)', 'total')\n                .where('invoice.tenantId = :tenantId', { tenantId })\n                .andWhere('invoice.status IN (:...statuses)', {\n                    statuses: ['paid', 'sent', 'viewed'],\n                })\n                .andWhere('invoice.deletedAt IS NULL')\n                .andWhere('invoice.invoiceDate BETWEEN :start AND :end', {\n                    start: start.toISOString().split('T')[0],\n                    end: end.toISOString().split('T')[0],\n                })\n                .getRawOne(),\n            // Previous period revenue for comparison\n            this.invoiceRepository\n                .createQueryBuilder('invoice')\n                .select('COALESCE(SUM(invoice.totalAmount), 0)', 'total')\n                .where('invoice.tenantId = :tenantId', { tenantId })\n                .andWhere('invoice.status IN (:...statuses)', {\n                    statuses: ['paid', 'sent', 'viewed'],\n                })\n                .andWhere('invoice.deletedAt IS NULL')\n                .andWhere('invoice.invoiceDate BETWEEN :start AND :end', {\n                    start: previousStart.toISOString().split('T')[0],\n                    end: previousEnd.toISOString().split('T')[0],\n                })\n                .getRawOne(),\n            // Recent cases\n            this.caseRepository.find({\n                where: { tenantId, deletedAt: null as any },\n                order: { createdAt: 'DESC' },\n                take: 5,\n                relations: ['client'],\n            }),\n            // Upcoming events\n            this.eventRepository.find({\n                where: {\n                    tenantId,\n                    eventDate: MoreThan(new Date()),\n                    status: 'scheduled',\n                    deletedAt: null as any,\n                },\n                order: { eventDate: 'ASC' },\n                take: 5,\n                relations: ['case'],\n            }),\n            // Activity feed\n            this.auditLogRepository.find({\n                where: { tenantId, createdAt: Between(start, end) },\n                order: { createdAt: 'DESC' },\n                take: 10,\n                relations: ['user'],\n            }),\n            // Revenue data for chart (daily aggregation)\n            this.invoiceRepository\n                .createQueryBuilder('invoice')\n                .select('invoice.invoiceDate', 'date')\n                .addSelect('COALESCE(SUM(invoice.totalAmount), 0)', 'amount')\n                .addSelect('COALESCE(SUM(invoice.paidAmount), 0)', 'paidAmount')\n                .where('invoice.tenantId = :tenantId', { tenantId })\n                .andWhere('invoice.deletedAt IS NULL')\n                .andWhere('invoice.invoiceDate BETWEEN :start AND :end', {\n                    start: start.toISOString().split('T')[0],\n                    end: end.toISOString().split('T')[0],\n                })\n                .groupBy('invoice.invoiceDate')\n                .orderBy('invoice.invoiceDate', 'ASC')\n                .getRawMany(),\n        ]);\n\n        // Calculate pending tasks\n        const pendingTasks = await this.getPendingTasks(tenantId, now);\n\n        // Calculate revenue change percentage\n        const currentRevenue = parseFloat(totalRevenue.total) || 0;\n        const previousRevenue = parseFloat(previousTotalRevenue.total) || 0;\n        const revenueChange = previousRevenue > 0\n            ? ((currentRevenue - previousRevenue) / previousRevenue) * 100\n            : currentRevenue > 0 ? 100 : 0;\n\n        // Build stat cards\n        const stats: StatCardDto[] = [\n            {\n                label: 'Всього клієнтів',\n                value: totalClients,\n                change: 0, // Could calculate based on client creation date\n                trend: 'neutral',\n                icon: 'users',\n            },\n            {\n                label: 'Активні справи',\n                value: activeCases,\n                change: 0,\n                trend: 'neutral',\n                icon: 'briefcase',\n            },\n            {\n                label: 'Всього справ',\n                value: totalCases,\n                change: 0,\n                trend: 'neutral',\n                icon: 'folder',\n            },\n            {\n                label: 'Дохід',\n                value: currentRevenue,\n                change: revenueChange,\n                trend: revenueChange > 0 ? 'up' : revenueChange < 0 ? 'down' : 'neutral',\n                icon: 'dollar-sign',\n            },\n        ];\n\n        // Build recent cases DTOs\n        const recentCasesDtos: RecentCaseDto[] = recentCases.map((c) => ({\n            id: c.id,\n            caseNumber: c.caseNumber,\n            title: c.title || 'Без назви',\n            clientName: this.formatClientName(c.client),\n            status: this.translateCaseStatus(c.status),\n            priority: this.translatePriority(c.priority),\n            nextHearingDate: c.nextHearingDate || c.startDate,\n        }));\n\n        // Build upcoming events DTOs\n        const upcomingEventsDtos: UpcomingEventDto[] = upcomingEvents.map((e) => ({\n            id: e.id,\n            title: e.title,\n            type: this.translateEventType(e.type),\n            eventDate: e.eventDate,\n            location: e.location || e.courtName || 'Не вказано',\n            caseNumber: e.case ? e.case.caseNumber : 'Немає',\n        }));\n\n        // Build activity feed DTOs\n        const activityFeedDtos: ActivityFeedDto[] = activityFeed.map((a) => ({\n            id: a.id,\n            userName: a.user ? `${a.user.firstName} ${a.user.lastName}` : 'Система',\n            action: this.translateAuditAction(a.action),\n            entityType: this.translateEntityType(a.entityType),\n            entityDescription: this.getEntityDescription(a),\n            timestamp: a.createdAt,\n        }));\n\n        // Build revenue data DTOs\n        const revenueDataDtos: RevenueDataPointDto[] = invoicesByDate.map((d) => ({\n            date: new Date(d.date),\n            amount: parseFloat(d.amount),\n            paidAmount: parseFloat(d.paidAmount),\n        }));\n\n        return {\n            stats,\n            recentCases: recentCasesDtos,\n            upcomingEvents: upcomingEventsDtos,\n            activityFeed: activityFeedDtos,\n            pendingTasks,\n            revenueData: revenueDataDtos,\n        };\n    }\n\n    /**\n     * Get pending tasks (deadlines, hearings, etc.)\n     */\n    private async getPendingTasks(tenantId: string, now: Date): Promise<TaskDto[]> {\n        const tasks: TaskDto[] = [];\n\n        // Get cases with upcoming deadlines (next 7 days)\n        const deadlineCases = await this.caseRepository.find({\n            where: {\n                tenantId,\n                deadlineDate: MoreThan(now),\n                status: 'active',\n                deletedAt: null as any,\n            },\n            relations: ['client'],\n            take: 10,\n        });\n\n        deadlineCases.forEach((c) => {\n            if (c.deadlineDate) {\n                tasks.push({\n                    id: `case-deadline-${c.id}`,\n                    title: `Дедлайн: ${c.title || c.caseNumber}`,\n                    type: 'deadline',\n                    dueDate: c.deadlineDate,\n                    caseNumber: c.caseNumber,\n                    priority: this.translatePriority(c.priority),\n                });\n            }\n        });\n\n        // Get upcoming hearings (next 7 days)\n        const hearingEvents = await this.eventRepository.find({\n            where: {\n                tenantId,\n                type: 'hearing',\n                eventDate: Between(now, new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000)),\n                status: 'scheduled',\n                deletedAt: null as any,\n            },\n            relations: ['case', 'case.client'],\n            take: 10,\n        });\n\n        hearingEvents.forEach((e) => {\n            tasks.push({\n                id: `event-${e.id}`,\n                title: `Судове засідання: ${e.title}`,\n                type: 'hearing',\n                dueDate: e.eventDate,\n                caseNumber: e.case ? e.case.caseNumber : 'Немає',\n                priority: 'high',\n            });\n        });\n\n        // Sort by due date\n        tasks.sort((a, b) => a.dueDate.getTime() - b.dueDate.getTime());\n\n        return tasks.slice(0, 10);\n    }\n\n    /**\n     * Format client name\n     */\n    private formatClientName(client: Client | null): string {\n        if (!client) return 'Невідомий клієнт';\n\n        if (client.type === 'legal_entity') {\n            return client.companyName || 'Юридична особа';\n        }\n\n        return `${client.firstName || ''} ${client.lastName || ''}`.trim() || 'Фізична особа';\n    }\n\n    /**\n     * Translate case status to Ukrainian\n     */\n    private translateCaseStatus(status: string): string {\n        const statusMap: Record<string, string> = {\n            draft: 'Чернетка',\n            active: 'Активна',\n            on_hold: 'Призупинена',\n            closed: 'Закрита',\n            archived: 'Архівна',\n        };\n        return statusMap[status] || status;\n    }\n\n    /**\n     * Translate priority to Ukrainian\n     */\n    private translatePriority(priority: string): string {\n        const priorityMap: Record<string, string> = {\n            low: 'Низький',\n            medium: 'Середній',\n            high: 'Високий',\n            urgent: 'Терміновий',\n        };\n        return priorityMap[priority] || priority;\n    }\n\n    /**\n     * Translate event type to Ukrainian\n     */\n    private translateEventType(type: string): string {\n        const typeMap: Record<string, string> = {\n            hearing: 'Судове засідання',\n            deadline: 'Дедлайн',\n            meeting: 'Зустріч',\n            court_sitting: 'Судове слухання',\n            other: 'Інше',\n        };\n        return typeMap[type] || type;\n    }\n\n    /**\n     * Translate audit action to Ukrainian\n     */\n    private translateAuditAction(action: AuditAction): string {\n        const actionMap: Record<string, string> = {\n            [AuditAction.CREATE]: 'Створено',\n            [AuditAction.UPDATE]: 'Оновлено',\n            [AuditAction.DELETE]: 'Видалено',\n            [AuditAction.LOGIN]: 'Увійшов',\n            [AuditAction.LOGOUT]: 'Вийшов',\n            [AuditAction.PERMISSION_CHANGE]: 'Змінено права',\n        };\n        return actionMap[action] || action;\n    }\n\n    /**\n     * Translate entity type to Ukrainian\n     */\n    private translateEntityType(entityType: string): string {\n        const typeMap: Record<string, string> = {\n            case: 'справу',\n            client: 'клієнта',\n            document: 'документ',\n            event: 'подію',\n            invoice: 'рахунок',\n            user: 'користувача',\n            organization: 'організацію',\n        };\n        return typeMap[entityType] || entityType;\n    }\n\n    /**\n     * Get entity description from audit log\n     */\n    private getEntityDescription(auditLog: AuditLog): string {\n        if (auditLog.entityType === 'case' && auditLog.newValues?.caseNumber) {\n            return `справа №${auditLog.newValues.caseNumber}`;\n        }\n        if (auditLog.entityType === 'client' && auditLog.newValues) {\n            const firstName = auditLog.newValues.firstName || '';\n            const lastName = auditLog.newValues.lastName || '';\n            const companyName = auditLog.newValues.companyName || '';\n            return companyName || `${firstName} ${lastName}`.trim() || auditLog.entityId || '';\n        }\n        return auditLog.entityId || auditLog.entityType;\n    }\n}\n"],"names":["DashboardService","getDashboardStats","tenantId","query","days","startDate","endDate","now","Date","start","getTime","end","daysInMillis","previousStart","previousEnd","totalClients","activeCases","totalCases","totalRevenue","previousTotalRevenue","recentCases","upcomingEvents","activityFeed","invoicesByDate","Promise","all","clientRepository","count","where","status","deletedAt","caseRepository","invoiceRepository","createQueryBuilder","select","andWhere","statuses","toISOString","split","getRawOne","find","order","createdAt","take","relations","eventRepository","eventDate","MoreThan","auditLogRepository","Between","addSelect","groupBy","orderBy","getRawMany","pendingTasks","getPendingTasks","currentRevenue","parseFloat","total","previousRevenue","revenueChange","stats","label","value","change","trend","icon","recentCasesDtos","map","c","id","caseNumber","title","clientName","formatClientName","client","translateCaseStatus","priority","translatePriority","nextHearingDate","upcomingEventsDtos","e","type","translateEventType","location","courtName","case","activityFeedDtos","a","userName","user","firstName","lastName","action","translateAuditAction","entityType","translateEntityType","entityDescription","getEntityDescription","timestamp","revenueDataDtos","d","date","amount","paidAmount","revenueData","tasks","deadlineCases","deadlineDate","forEach","push","dueDate","hearingEvents","sort","b","slice","companyName","trim","statusMap","draft","active","on_hold","closed","archived","priorityMap","low","medium","high","urgent","typeMap","hearing","deadline","meeting","court_sitting","other","actionMap","AuditAction","CREATE","UPDATE","DELETE","LOGIN","LOGOUT","PERMISSION_CHANGE","document","event","invoice","organization","auditLog","newValues","entityId"],"mappings":"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"}