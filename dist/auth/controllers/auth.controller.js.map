{"version":3,"sources":["../../../src/auth/controllers/auth.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Post,\n    Body,\n    Get,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\n    Req,\n    Request,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\nimport { Throttle } from '@nestjs/throttler';\nimport { AuthService } from '../services/auth.service';\nimport { LoginDto, LoginResponseDto } from '../dto/login.dto';\nimport { RegisterDto } from '../dto/register.dto';\nimport { RefreshTokenDto, RefreshTokenResponseDto, LogoutDto } from '../dto/refresh-token.dto';\nimport { ForgotPasswordDto, ResetPasswordDto } from '../dto/forgot-password.dto';\nimport { VerifyEmailDto } from '../dto/verify-email.dto';\nimport { JwtAuthGuard } from '../guards';\nimport { JwtPayload } from '../interfaces/jwt.interface';\n\n/**\n * Auth Controller\n */\n@ApiTags('Authentication')\n@Controller('auth')\nexport class AuthController {\n    constructor(private readonly authService: AuthService) {}\n\n    @Post('register')\n    @HttpCode(HttpStatus.CREATED)\n    @Throttle({ default: { limit: 5, ttl: 3600000 } })\n    @ApiOperation({ summary: 'Register new user (email + password only)' })\n    @ApiResponse({ status: 201, description: 'User registered successfully' })\n    @ApiResponse({ status: 400, description: 'Validation error' })\n    @ApiResponse({ status: 409, description: 'Email already exists' })\n    async register(@Body() dto: RegisterDto): Promise<{\n        userId: string;\n        accessToken: string;\n        refreshToken: string;\n    }> {\n        return this.authService.register(dto);\n    }\n\n    @Post('login')\n    @HttpCode(HttpStatus.OK)\n    @Throttle({ default: { limit: 5, ttl: 60000 } })\n    @ApiOperation({ summary: 'Login user' })\n    @ApiResponse({ status: 200, description: 'Login successful', type: LoginResponseDto })\n    @ApiResponse({ status: 401, description: 'Invalid credentials' })\n    async login(@Body() dto: LoginDto, @Req() req: Request): Promise<LoginResponseDto> {\n        const ipAddress = (req as any).ip || (req as any).connection?.remoteAddress || '0.0.0.0';\n        const userAgent = req.headers['user-agent'];\n\n        return this.authService.login(dto, ipAddress, userAgent);\n    }\n\n    @Post('refresh')\n    @HttpCode(HttpStatus.OK)\n    @ApiOperation({ summary: 'Refresh access token' })\n    @ApiResponse({ status: 200, description: 'Token refreshed', type: RefreshTokenResponseDto })\n    @ApiResponse({ status: 401, description: 'Invalid refresh token' })\n    async refreshToken(@Body() dto: RefreshTokenDto): Promise<RefreshTokenResponseDto> {\n        return this.authService.refreshToken(dto);\n    }\n\n    @Post('logout')\n    @UseGuards(JwtAuthGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Logout user' })\n    @ApiResponse({ status: 204, description: 'Logout successful' })\n    async logout(@Req() req: Request, @Body() dto?: LogoutDto): Promise<void> {\n        const userId = (req as any).user?.user_id;\n        await this.authService.logout(userId, dto);\n    }\n\n    @Post('logout-all')\n    @UseGuards(JwtAuthGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Logout from all devices' })\n    @ApiResponse({ status: 204, description: 'Logged out from all devices' })\n    async logoutAll(@Req() req: Request): Promise<void> {\n        const userId = (req as any).user?.user_id;\n        await this.authService.logoutAllDevices(userId);\n    }\n\n    @Post('forgot-password')\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @Throttle({ default: { limit: 3, ttl: 3600000 } })\n    @ApiOperation({ summary: 'Request password reset' })\n    @ApiResponse({ status: 204, description: 'Password reset email sent' })\n    async forgotPassword(@Body() dto: ForgotPasswordDto): Promise<void> {\n        await this.authService.forgotPassword(dto);\n    }\n\n    @Post('reset-password')\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Reset password with token' })\n    @ApiResponse({ status: 204, description: 'Password reset successful' })\n    @ApiResponse({ status: 400, description: 'Invalid or expired token' })\n    async resetPassword(@Body() dto: ResetPasswordDto): Promise<void> {\n        await this.authService.resetPassword(dto);\n    }\n\n    @Post('verify-email')\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Verify email address' })\n    @ApiResponse({ status: 204, description: 'Email verified successfully' })\n    @ApiResponse({ status: 400, description: 'Invalid or expired token' })\n    async verifyEmail(@Body() dto: VerifyEmailDto): Promise<void> {\n        await this.authService.verifyEmail(dto);\n    }\n\n    @Get('me')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Get current user info' })\n    @ApiResponse({ status: 200, description: 'User info retrieved' })\n    async getMe(@Req() req: Request): Promise<JwtPayload> {\n        return (req as any).user;\n    }\n}\n"],"names":["AuthController","register","dto","authService","login","req","ipAddress","ip","connection","remoteAddress","userAgent","headers","refreshToken","logout","userId","user","user_id","logoutAll","logoutAllDevices","forgotPassword","resetPassword","verifyEmail","getMe","CREATED","default","limit","ttl","summary","status","description","OK","type","LoginResponseDto","RefreshTokenResponseDto","NO_CONTENT"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAjBN;yBAC2D;2BACzC;6BACG;0BACe;6BACf;iCACwC;mCAChB;gCACrB;wBACF;;;;;;;;;;;;;;;AAQtB,IAAA,AAAMA,iBAAN,MAAMA;IAGT,MAOMC,SAAS,AAAQC,GAAgB,EAIpC;QACC,OAAO,IAAI,CAACC,WAAW,CAACF,QAAQ,CAACC;IACrC;IAEA,MAMME,MAAM,AAAQF,GAAa,EAAE,AAAOG,GAAY,EAA6B;QAC/E,MAAMC,YAAY,AAACD,IAAYE,EAAE,IAAI,AAACF,IAAYG,UAAU,EAAEC,iBAAiB;QAC/E,MAAMC,YAAYL,IAAIM,OAAO,CAAC,aAAa;QAE3C,OAAO,IAAI,CAACR,WAAW,CAACC,KAAK,CAACF,KAAKI,WAAWI;IAClD;IAEA,MAKME,aAAa,AAAQV,GAAoB,EAAoC;QAC/E,OAAO,IAAI,CAACC,WAAW,CAACS,YAAY,CAACV;IACzC;IAEA,MAMMW,OAAO,AAAOR,GAAY,EAAE,AAAQH,GAAe,EAAiB;QACtE,MAAMY,SAAS,AAACT,IAAYU,IAAI,EAAEC;QAClC,MAAM,IAAI,CAACb,WAAW,CAACU,MAAM,CAACC,QAAQZ;IAC1C;IAEA,MAMMe,UAAU,AAAOZ,GAAY,EAAiB;QAChD,MAAMS,SAAS,AAACT,IAAYU,IAAI,EAAEC;QAClC,MAAM,IAAI,CAACb,WAAW,CAACe,gBAAgB,CAACJ;IAC5C;IAEA,MAKMK,eAAe,AAAQjB,GAAsB,EAAiB;QAChE,MAAM,IAAI,CAACC,WAAW,CAACgB,cAAc,CAACjB;IAC1C;IAEA,MAKMkB,cAAc,AAAQlB,GAAqB,EAAiB;QAC9D,MAAM,IAAI,CAACC,WAAW,CAACiB,aAAa,CAAClB;IACzC;IAEA,MAKMmB,YAAY,AAAQnB,GAAmB,EAAiB;QAC1D,MAAM,IAAI,CAACC,WAAW,CAACkB,WAAW,CAACnB;IACvC;IAEA,MAKMoB,MAAM,AAAOjB,GAAY,EAAuB;QAClD,OAAO,AAACA,IAAYU,IAAI;IAC5B;IA/FA,YAAY,AAAiBZ,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AAgG5D;;;6CA7FyBoB;;QACTC,SAAS;YAAEC,OAAO;YAAGC,KAAK;QAAQ;;;QAC9BC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAUpBC;;QACTN,SAAS;YAAEC,OAAO;YAAGC,KAAK;QAAM;;;QAC5BC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;QAAoBE,MAAMC,0BAAgB;;;QACpEJ,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;6CASpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;QAAmBE,MAAME,wCAAuB;;;QAC1EL,QAAQ;QAAKC,aAAa;;;;;;;;;;;;6CAOpBK;;;QAELP,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;6CAQpBK;;;QAELP,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAOpBK;;QACTV,SAAS;YAAEC,OAAO;YAAGC,KAAK;QAAQ;;;QAC9BC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAMpBK;;QACLP,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAMpBK;;QACLP,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAQzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa"}