{"version":3,"sources":["../../../src/auth/controllers/organization.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Post,\n    Body,\n    Get,\n    Put,\n    Patch,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\n    Req,\n    Request,\n    Param,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\nimport { Throttle } from '@nestjs/throttler';\nimport { AuthService } from '../services/auth.service';\nimport { OrganizationService } from '../services/organization.service';\nimport { RegisterOrganizationDto } from '../dto/register.dto';\nimport { JwtAuthGuard } from '../guards';\n\n/**\n * Organization Controller\n */\n@ApiTags('Organizations')\n@Controller('organizations')\nexport class OrganizationController {\n    constructor(\n        private readonly authService: AuthService,\n        private readonly organizationService: OrganizationService,\n    ) {}\n\n    @Post('register')\n    @HttpCode(HttpStatus.CREATED)\n    @Throttle({ default: { limit: 3, ttl: 3600000 } })\n    @ApiOperation({ summary: 'Register new organization' })\n    @ApiResponse({ status: 201, description: 'Organization registered successfully' })\n    @ApiResponse({ status: 400, description: 'Validation error' })\n    async register(@Body() dto: RegisterOrganizationDto): Promise<{\n        organizationId: string;\n        userId: string;\n    }> {\n        return this.authService.registerOrganization(dto);\n    }\n\n    @Get('me')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Get current organization info' })\n    @ApiResponse({ status: 200, description: 'Organization info retrieved' })\n    async getOrganization(@Req() req: Request): Promise<any> {\n        const tenantId = (req as any).user?.tenant_id;\n        return this.organizationService.getOrganizationById(tenantId);\n    }\n\n    @Put('me')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Update organization info' })\n    @ApiResponse({ status: 200, description: 'Organization updated' })\n    async updateOrganization(\n        @Req() req: Request,\n        @Body() data: any\n    ): Promise<any> {\n        const tenantId = (req as any).user?.tenant_id;\n        return this.organizationService.updateOrganization(tenantId, data);\n    }\n\n    @Get('subscription')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Get subscription status' })\n    @ApiResponse({ status: 200, description: 'Subscription info retrieved' })\n    async getSubscription(@Req() req: Request): Promise<any> {\n        const tenantId = (req as any).user?.tenant_id;\n        return this.organizationService.getSubscriptionStatus(tenantId);\n    }\n\n    @Get('onboarding')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Get onboarding progress' })\n    @ApiResponse({ status: 200, description: 'Onboarding progress retrieved' })\n    async getOnboardingProgress(@Req() req: Request): Promise<any> {\n        const tenantId = (req as any).user?.tenant_id;\n        const userId = (req as any).user?.user_id;\n        return this.organizationService.getOnboardingProgress(tenantId, userId);\n    }\n\n    @Patch('onboarding/:step')\n    @UseGuards(JwtAuthGuard)\n    @ApiBearerAuth()\n    @ApiOperation({ summary: 'Update onboarding step' })\n    @ApiResponse({ status: 200, description: 'Onboarding step updated' })\n    async updateOnboardingStep(\n        @Param('step') step: string,\n        @Req() req: Request,\n        @Body() data: { completed: boolean; data?: Record<string, any> }\n    ): Promise<void> {\n        const tenantId = (req as any).user?.tenant_id;\n        const userId = (req as any).user?.user_id;\n\n        await this.organizationService.updateOnboardingStep(\n            tenantId,\n            userId,\n            step,\n            data.completed,\n            data.data\n        );\n    }\n}\n"],"names":["OrganizationController","register","dto","authService","registerOrganization","getOrganization","req","tenantId","user","tenant_id","organizationService","getOrganizationById","updateOrganization","data","getSubscription","getSubscriptionStatus","getOnboardingProgress","userId","user_id","updateOnboardingStep","step","completed","CREATED","default","limit","ttl","summary","status","description"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBAbN;yBAC2D;2BACzC;6BACG;qCACQ;6BACI;wBACX;;;;;;;;;;;;;;;AAOtB,IAAA,AAAMA,yBAAN,MAAMA;IAMT,MAMMC,SAAS,AAAQC,GAA4B,EAGhD;QACC,OAAO,IAAI,CAACC,WAAW,CAACC,oBAAoB,CAACF;IACjD;IAEA,MAKMG,gBAAgB,AAAOC,GAAY,EAAgB;QACrD,MAAMC,WAAW,AAACD,IAAYE,IAAI,EAAEC;QACpC,OAAO,IAAI,CAACC,mBAAmB,CAACC,mBAAmB,CAACJ;IACxD;IAEA,MAKMK,mBACF,AAAON,GAAY,EACnB,AAAQO,IAAS,EACL;QACZ,MAAMN,WAAW,AAACD,IAAYE,IAAI,EAAEC;QACpC,OAAO,IAAI,CAACC,mBAAmB,CAACE,kBAAkB,CAACL,UAAUM;IACjE;IAEA,MAKMC,gBAAgB,AAAOR,GAAY,EAAgB;QACrD,MAAMC,WAAW,AAACD,IAAYE,IAAI,EAAEC;QACpC,OAAO,IAAI,CAACC,mBAAmB,CAACK,qBAAqB,CAACR;IAC1D;IAEA,MAKMS,sBAAsB,AAAOV,GAAY,EAAgB;QAC3D,MAAMC,WAAW,AAACD,IAAYE,IAAI,EAAEC;QACpC,MAAMQ,SAAS,AAACX,IAAYE,IAAI,EAAEU;QAClC,OAAO,IAAI,CAACR,mBAAmB,CAACM,qBAAqB,CAACT,UAAUU;IACpE;IAEA,MAKME,qBACF,AAAeC,IAAY,EAC3B,AAAOd,GAAY,EACnB,AAAQO,IAAwD,EACnD;QACb,MAAMN,WAAW,AAACD,IAAYE,IAAI,EAAEC;QACpC,MAAMQ,SAAS,AAACX,IAAYE,IAAI,EAAEU;QAElC,MAAM,IAAI,CAACR,mBAAmB,CAACS,oBAAoB,CAC/CZ,UACAU,QACAG,MACAP,KAAKQ,SAAS,EACdR,KAAKA,IAAI;IAEjB;IAlFA,YACI,AAAiBV,WAAwB,EACzC,AAAiBO,mBAAwC,CAC3D;aAFmBP,cAAAA;aACAO,sBAAAA;IAClB;AAgFP;;;6CA7EyBY;;QACTC,SAAS;YAAEC,OAAO;YAAGC,KAAK;QAAQ;;;QAC9BC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAWzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QASzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;QAYzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QASzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa"}