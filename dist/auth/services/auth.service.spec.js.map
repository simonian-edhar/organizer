{"version":3,"sources":["../../../src/auth/services/auth.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { DataSource, Repository } from 'typeorm';\nimport { UnauthorizedException, ConflictException } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { User } from '../../database/entities/User.entity';\nimport { Organization } from '../../database/entities/Organization.entity';\nimport { RefreshToken } from '../../database/entities/RefreshToken.entity';\nimport { Subscription } from '../../database/entities/Subscription.entity';\nimport { JwtService } from './jwt.service';\nimport { AuditService } from './audit.service';\nimport { LoggingService } from '../../common/logging';\nimport { UserRole, UserStatus } from '../../database/entities/enums/subscription.enum';\nimport * as cryptoUtil from '../../common/utils/crypto.util';\nimport * as validationUtil from '../../common/utils/validation.util';\n\n// Mock crypto utilities\njest.mock('../../common/utils/crypto.util');\njest.mock('../../common/utils/validation.util');\n\ndescribe('AuthService', () => {\n    let service: AuthService;\n    let userRepository: jest.Mocked<Repository<User>>;\n    let organizationRepository: jest.Mocked<Repository<Organization>>;\n    let refreshTokenRepository: jest.Mocked<Repository<RefreshToken>>;\n    let subscriptionRepository: jest.Mocked<Repository<Subscription>>;\n    let jwtService: jest.Mocked<JwtService>;\n    let auditService: jest.Mocked<AuditService>;\n    let loggingService: jest.Mocked<LoggingService>;\n    let dataSource: jest.Mocked<DataSource>;\n\n    const mockTenantId = 'test-tenant-id';\n    const mockUserId = 'test-user-id';\n    const mockEmail = 'test@example.com';\n    const mockPassword = 'StrongP@ss123';\n    const mockIpAddress = '127.0.0.1';\n    const mockUserAgent = 'test-agent';\n\n    beforeEach(async () => {\n        const mockRepository = () => ({\n            findOne: jest.fn(),\n            save: jest.fn(),\n            update: jest.fn(),\n            increment: jest.fn(),\n            find: jest.fn(),\n            create: jest.fn(),\n        });\n\n        const mockQueryRunner = {\n            connect: jest.fn(),\n            startTransaction: jest.fn(),\n            commitTransaction: jest.fn(),\n            rollbackTransaction: jest.fn(),\n            release: jest.fn(),\n            manager: {\n                create: jest.fn(),\n                save: jest.fn(),\n                getRepository: jest.fn().mockReturnValue({\n                    save: jest.fn(),\n                }),\n            },\n        };\n\n        const module: TestingModule = await Test.createTestingModule({\n            providers: [\n                AuthService,\n                {\n                    provide: getRepositoryToken(User),\n                    useFactory: mockRepository,\n                },\n                {\n                    provide: getRepositoryToken(Organization),\n                    useFactory: mockRepository,\n                },\n                {\n                    provide: getRepositoryToken(RefreshToken),\n                    useFactory: mockRepository,\n                },\n                {\n                    provide: getRepositoryToken(Subscription),\n                    useFactory: mockRepository,\n                },\n                {\n                    provide: JwtService,\n                    useValue: {\n                        generateAccessToken: jest.fn(),\n                        generateRefreshToken: jest.fn(),\n                        verifyRefreshToken: jest.fn(),\n                    },\n                },\n                {\n                    provide: AuditService,\n                    useValue: {\n                        log: jest.fn(),\n                    },\n                },\n                {\n                    provide: LoggingService,\n                    useValue: {\n                        debug: jest.fn(),\n                        logAuthEvent: jest.fn(),\n                        logSecurityEvent: jest.fn(),\n                        logBusinessEvent: jest.fn(),\n                        logError: jest.fn(),\n                    },\n                },\n                {\n                    provide: DataSource,\n                    useValue: {\n                        createQueryRunner: jest.fn().mockReturnValue(mockQueryRunner),\n                    },\n                },\n            ],\n        }).compile();\n\n        service = module.get<AuthService>(AuthService);\n        userRepository = module.get(getRepositoryToken(User));\n        organizationRepository = module.get(getRepositoryToken(Organization));\n        refreshTokenRepository = module.get(getRepositoryToken(RefreshToken));\n        subscriptionRepository = module.get(getRepositoryToken(Subscription));\n        jwtService = module.get(JwtService);\n        auditService = module.get(AuditService);\n        loggingService = module.get(LoggingService);\n        dataSource = module.get(DataSource);\n    });\n\n    afterEach(() => {\n        jest.clearAllMocks();\n    });\n\n    describe('login', () => {\n        const mockUser = {\n            id: mockUserId,\n            tenantId: mockTenantId,\n            email: mockEmail,\n            passwordHash: 'hashed-password',\n            salt: 'salt',\n            role: UserRole.LAWYER,\n            status: UserStatus.ACTIVE,\n            failedLoginAttempts: 0,\n            lockedUntil: null,\n            mfaEnabled: false,\n            organization: {\n                id: mockTenantId,\n                subscriptionPlan: 'basic',\n                subscriptionStatus: 'active',\n            },\n        } as any;\n\n        const mockLoginDto = {\n            email: mockEmail,\n            password: mockPassword,\n        };\n\n        beforeEach(() => {\n            (validationUtil.validatePasswordStrength as jest.Mock).mockReturnValue({ valid: true });\n            (cryptoUtil.verifyPassword as jest.Mock).mockResolvedValue(true);\n            (cryptoUtil.generateUuid as jest.Mock).mockReturnValue('test-uuid');\n            (cryptoUtil.generateDeviceFingerprint as jest.Mock).mockReturnValue('test-device-id');\n        });\n\n        it('should successfully login with valid credentials', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser);\n            jwtService.generateAccessToken.mockResolvedValue('access-token');\n            jwtService.generateRefreshToken.mockResolvedValue('refresh-token');\n            refreshTokenRepository.save.mockResolvedValue({} as any);\n            refreshTokenRepository.find.mockResolvedValue([]);\n            userRepository.update.mockResolvedValue({} as any);\n\n            const result = await service.login(mockLoginDto, mockIpAddress, mockUserAgent);\n\n            expect(result).toHaveProperty('accessToken');\n            expect(result).toHaveProperty('refreshToken');\n            expect(result.user.email).toBe(mockEmail);\n            expect(loggingService.logAuthEvent).toHaveBeenCalledWith('login', expect.any(Object));\n        });\n\n        it('should throw UnauthorizedException for non-existent user', async () => {\n            userRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(loggingService.logAuthEvent).toHaveBeenCalledWith('login_failed', expect.any(Object));\n        });\n\n        it('should throw UnauthorizedException for suspended account', async () => {\n            const suspendedUser = {\n                ...mockUser,\n                status: UserStatus.SUSPENDED,\n            };\n            userRepository.findOne.mockResolvedValue(suspendedUser);\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(loggingService.logSecurityEvent).toHaveBeenCalledWith(\n                'login_attempt_suspended',\n                'high',\n                expect.any(Object)\n            );\n        });\n\n        it('should throw UnauthorizedException for locked account', async () => {\n            const lockedUser = {\n                ...mockUser,\n                lockedUntil: new Date(Date.now() + 30 * 60 * 1000),\n            };\n            userRepository.findOne.mockResolvedValue(lockedUser);\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(loggingService.logSecurityEvent).toHaveBeenCalledWith(\n                'login_attempt_locked',\n                'medium',\n                expect.any(Object)\n            );\n        });\n\n        it('should increment failed attempts on wrong password', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser);\n            (cryptoUtil.verifyPassword as jest.Mock).mockResolvedValue(false);\n            userRepository.increment.mockResolvedValue({} as any);\n            userRepository.findOne.mockResolvedValue({ ...mockUser, failedLoginAttempts: 1 });\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(userRepository.increment).toHaveBeenCalledWith(\n                { id: mockUserId },\n                'failedLoginAttempts',\n                1\n            );\n        });\n\n        it('should lock account after 5 failed attempts', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser);\n            (cryptoUtil.verifyPassword as jest.Mock).mockResolvedValue(false);\n            userRepository.increment.mockResolvedValue({} as any);\n            userRepository.findOne.mockResolvedValue({ ...mockUser, failedLoginAttempts: 5 });\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(userRepository.update).toHaveBeenCalledWith(\n                mockUserId,\n                { lockedUntil: expect.any(Date) }\n            );\n        });\n\n        it('should require MFA code when MFA is enabled', async () => {\n            const mfaUser = {\n                ...mockUser,\n                mfaEnabled: true,\n            };\n            userRepository.findOne.mockResolvedValue(mfaUser);\n\n            await expect(service.login(mockLoginDto, mockIpAddress, mockUserAgent))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(loggingService.logAuthEvent).toHaveBeenCalledWith('mfa_required', expect.any(Object));\n        });\n    });\n\n    describe('refreshToken', () => {\n        const mockRefreshTokenDto = {\n            refreshToken: 'test-refresh-token',\n        };\n\n        const mockPayload = {\n            user_id: mockUserId,\n            tenant_id: mockTenantId,\n            device_id: 'test-device-id',\n        };\n\n        const mockRefreshTokenEntity = {\n            id: 'token-id',\n            userId: mockUserId,\n            tenantId: mockTenantId,\n            token: 'test-refresh-token',\n            revokedAt: null,\n            expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\n            deviceInfo: {},\n        };\n\n        const mockUser = {\n            id: mockUserId,\n            tenantId: mockTenantId,\n            email: mockEmail,\n            role: UserRole.LAWYER,\n            organization: {\n                subscriptionPlan: 'basic',\n            },\n        };\n\n        beforeEach(() => {\n            (cryptoUtil.generateUuid as jest.Mock).mockReturnValue('test-uuid');\n        });\n\n        it('should successfully refresh tokens', async () => {\n            jwtService.verifyRefreshToken.mockResolvedValue(mockPayload);\n            refreshTokenRepository.findOne.mockResolvedValue(mockRefreshTokenEntity as any);\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n            jwtService.generateAccessToken.mockResolvedValue('new-access-token');\n            jwtService.generateRefreshToken.mockResolvedValue('new-refresh-token');\n            refreshTokenRepository.update.mockResolvedValue({} as any);\n            refreshTokenRepository.save.mockResolvedValue({} as any);\n\n            const result = await service.refreshToken(mockRefreshTokenDto);\n\n            expect(result).toHaveProperty('accessToken', 'new-access-token');\n            expect(result).toHaveProperty('refreshToken', 'new-refresh-token');\n        });\n\n        it('should throw UnauthorizedException for invalid refresh token', async () => {\n            jwtService.verifyRefreshToken.mockResolvedValue(mockPayload);\n            refreshTokenRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.refreshToken(mockRefreshTokenDto))\n                .rejects.toThrow(UnauthorizedException);\n        });\n\n        it('should throw UnauthorizedException for revoked token', async () => {\n            jwtService.verifyRefreshToken.mockResolvedValue(mockPayload);\n            refreshTokenRepository.findOne.mockResolvedValue({\n                ...mockRefreshTokenEntity,\n                revokedAt: new Date(),\n            } as any);\n\n            await expect(service.refreshToken(mockRefreshTokenDto))\n                .rejects.toThrow(UnauthorizedException);\n\n            expect(loggingService.logSecurityEvent).toHaveBeenCalledWith(\n                'revoked_refresh_token_used',\n                'high',\n                expect.any(Object)\n            );\n        });\n\n        it('should throw UnauthorizedException for expired token', async () => {\n            jwtService.verifyRefreshToken.mockResolvedValue(mockPayload);\n            refreshTokenRepository.findOne.mockResolvedValue({\n                ...mockRefreshTokenEntity,\n                expiresAt: new Date(Date.now() - 1000),\n            } as any);\n\n            await expect(service.refreshToken(mockRefreshTokenDto))\n                .rejects.toThrow(UnauthorizedException);\n        });\n    });\n\n    describe('logout', () => {\n        it('should revoke refresh token on logout', async () => {\n            refreshTokenRepository.update.mockResolvedValue({} as any);\n\n            await service.logout(mockUserId, { refreshToken: 'test-token' });\n\n            expect(refreshTokenRepository.update).toHaveBeenCalledWith(\n                { token: 'test-token' },\n                { revokedAt: expect.any(Date) }\n            );\n            expect(loggingService.logAuthEvent).toHaveBeenCalledWith('logout', { userId: mockUserId });\n        });\n\n        it('should log logout without token', async () => {\n            await service.logout(mockUserId);\n\n            expect(loggingService.logAuthEvent).toHaveBeenCalledWith('logout', { userId: mockUserId });\n        });\n    });\n\n    describe('logoutAllDevices', () => {\n        it('should revoke all refresh tokens for user', async () => {\n            refreshTokenRepository.update.mockResolvedValue({} as any);\n\n            await service.logoutAllDevices(mockUserId);\n\n            expect(refreshTokenRepository.update).toHaveBeenCalledWith(\n                { userId: mockUserId },\n                { revokedAt: expect.any(Date) }\n            );\n        });\n    });\n\n    describe('forgotPassword', () => {\n        const mockForgotDto = {\n            email: mockEmail,\n        };\n\n        beforeEach(() => {\n            (cryptoUtil.generateToken as jest.Mock).mockReturnValue('reset-token');\n        });\n\n        it('should generate reset token for existing user', async () => {\n            const mockUser = {\n                id: mockUserId,\n                tenantId: mockTenantId,\n                email: mockEmail,\n            };\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n            userRepository.update.mockResolvedValue({} as any);\n\n            await service.forgotPassword(mockForgotDto);\n\n            expect(userRepository.update).toHaveBeenCalledWith(\n                mockUserId,\n                {\n                    passwordResetToken: 'reset-token',\n                    passwordResetExpiresAt: expect.any(Date),\n                }\n            );\n        });\n\n        it('should not throw error for non-existent user', async () => {\n            userRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.forgotPassword(mockForgotDto)).resolves.not.toThrow();\n        });\n    });\n\n    describe('resetPassword', () => {\n        const mockResetDto = {\n            token: 'reset-token',\n            newPassword: 'NewStrongP@ss123',\n        };\n\n        const mockUser = {\n            id: mockUserId,\n            tenantId: mockTenantId,\n            passwordResetToken: 'reset-token',\n            passwordResetExpiresAt: new Date(Date.now() + 60 * 60 * 1000),\n        };\n\n        beforeEach(() => {\n            (validationUtil.validatePasswordStrength as jest.Mock).mockReturnValue({ valid: true });\n            (cryptoUtil.generateSalt as jest.Mock).mockResolvedValue('new-salt');\n            (cryptoUtil.hashPassword as jest.Mock).mockResolvedValue('new-hash');\n        });\n\n        it('should reset password with valid token', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n            userRepository.update.mockResolvedValue({} as any);\n\n            await service.resetPassword(mockResetDto);\n\n            expect(userRepository.update).toHaveBeenCalledWith(\n                mockUserId,\n                {\n                    passwordHash: 'new-hash',\n                    salt: 'new-salt',\n                    passwordResetToken: null,\n                    passwordResetExpiresAt: null,\n                    lastPasswordChangeAt: expect.any(Date),\n                }\n            );\n        });\n\n        it('should throw UnauthorizedException for invalid token', async () => {\n            userRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.resetPassword(mockResetDto))\n                .rejects.toThrow(UnauthorizedException);\n        });\n\n        it('should throw UnauthorizedException for expired token', async () => {\n            const expiredUser = {\n                ...mockUser,\n                passwordResetExpiresAt: new Date(Date.now() - 1000),\n            };\n            userRepository.findOne.mockResolvedValue(expiredUser as any);\n\n            await expect(service.resetPassword(mockResetDto))\n                .rejects.toThrow(UnauthorizedException);\n        });\n\n        it('should throw ConflictException for weak password', async () => {\n            (validationUtil.validatePasswordStrength as jest.Mock).mockReturnValue({\n                valid: false,\n                errors: ['Too short'],\n            });\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n\n            await expect(service.resetPassword(mockResetDto))\n                .rejects.toThrow(ConflictException);\n        });\n    });\n\n    describe('verifyEmail', () => {\n        const mockVerifyDto = {\n            token: 'verification-token',\n        };\n\n        const mockUser = {\n            id: mockUserId,\n            tenantId: mockTenantId,\n            emailVerificationToken: 'verification-token',\n            organization: {},\n        };\n\n        it('should verify email with valid token', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n            userRepository.update.mockResolvedValue({} as any);\n\n            await service.verifyEmail(mockVerifyDto);\n\n            expect(userRepository.update).toHaveBeenCalledWith(\n                mockUserId,\n                {\n                    emailVerified: true,\n                    emailVerifiedAt: expect.any(Date),\n                    emailVerificationToken: null,\n                    status: UserStatus.ACTIVE,\n                }\n            );\n        });\n\n        it('should throw UnauthorizedException for invalid token', async () => {\n            userRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.verifyEmail(mockVerifyDto))\n                .rejects.toThrow(UnauthorizedException);\n        });\n    });\n\n    describe('enableMfa', () => {\n        const mockUser = {\n            id: mockUserId,\n            tenantId: mockTenantId,\n        };\n\n        beforeEach(() => {\n            (cryptoUtil.generateTotpSecret as jest.Mock).mockReturnValue('test-secret');\n            (cryptoUtil.generateMfaBackupCodes as jest.Mock).mockReturnValue(['code1', 'code2']);\n        });\n\n        it('should enable MFA for user', async () => {\n            userRepository.findOne.mockResolvedValue(mockUser as any);\n            userRepository.update.mockResolvedValue({} as any);\n\n            const result = await service.enableMfa(mockUserId);\n\n            expect(result).toHaveProperty('secret', 'test-secret');\n            expect(result).toHaveProperty('backupCodes');\n            expect(userRepository.update).toHaveBeenCalledWith(\n                mockUserId,\n                {\n                    mfaSecret: 'test-secret',\n                    mfaBackupCodes: ['code1', 'code2'],\n                }\n            );\n        });\n\n        it('should throw UnauthorizedException for non-existent user', async () => {\n            userRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.enableMfa(mockUserId))\n                .rejects.toThrow(UnauthorizedException);\n        });\n    });\n});\n"],"names":["jest","mock","describe","service","userRepository","organizationRepository","refreshTokenRepository","subscriptionRepository","jwtService","auditService","loggingService","dataSource","mockTenantId","mockUserId","mockEmail","mockPassword","mockIpAddress","mockUserAgent","beforeEach","mockRepository","findOne","fn","save","update","increment","find","create","mockQueryRunner","connect","startTransaction","commitTransaction","rollbackTransaction","release","manager","getRepository","mockReturnValue","module","Test","createTestingModule","providers","AuthService","provide","getRepositoryToken","User","useFactory","Organization","RefreshToken","Subscription","JwtService","useValue","generateAccessToken","generateRefreshToken","verifyRefreshToken","AuditService","log","LoggingService","debug","logAuthEvent","logSecurityEvent","logBusinessEvent","logError","DataSource","createQueryRunner","compile","get","afterEach","clearAllMocks","mockUser","id","tenantId","email","passwordHash","salt","role","UserRole","LAWYER","status","UserStatus","ACTIVE","failedLoginAttempts","lockedUntil","mfaEnabled","organization","subscriptionPlan","subscriptionStatus","mockLoginDto","password","validationUtil","validatePasswordStrength","valid","cryptoUtil","verifyPassword","mockResolvedValue","generateUuid","generateDeviceFingerprint","it","result","login","expect","toHaveProperty","user","toBe","toHaveBeenCalledWith","any","Object","rejects","toThrow","UnauthorizedException","suspendedUser","SUSPENDED","lockedUser","Date","now","mfaUser","mockRefreshTokenDto","refreshToken","mockPayload","user_id","tenant_id","device_id","mockRefreshTokenEntity","userId","token","revokedAt","expiresAt","deviceInfo","logout","logoutAllDevices","mockForgotDto","generateToken","forgotPassword","passwordResetToken","passwordResetExpiresAt","resolves","not","mockResetDto","newPassword","generateSalt","hashPassword","resetPassword","lastPasswordChangeAt","expiredUser","errors","ConflictException","mockVerifyDto","emailVerificationToken","verifyEmail","emailVerified","emailVerifiedAt","generateTotpSecret","generateMfaBackupCodes","enableMfa","mfaSecret","mfaBackupCodes"],"mappings":"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"}