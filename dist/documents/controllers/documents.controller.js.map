{"version":3,"sources":["../../../src/documents/controllers/documents.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Get,\n    Post,\n    Put,\n    Patch,\n    Delete,\n    Body,\n    Param,\n    Query,\n    UseGuards,\n    UseInterceptors,\n    UploadedFile,\n    HttpCode,\n    HttpStatus,\nReq, } from '@nestjs/common';\nimport { FileInterceptor } from '@nestjs/platform-express';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiConsumes, ApiBody } from '@nestjs/swagger';\nimport { DocumentService } from '../services/document.service';\nimport { UploadDocumentDto, UpdateDocumentDto, DocumentFiltersDto, BulkUploadDocumentsDto, SignDocumentDto, GenerateSignedUrlDto } from '../dto/document.dto';\nimport { JwtAuthGuard } from '../../auth/guards';\nimport { TenantGuard, RbacGuard } from '../../auth/guards';\nimport { Audit } from '../../auth/services/audit.service';\n\n/**\n * Documents Controller\n */\n@ApiTags('Documents')\n@Controller('documents')\n@UseGuards(JwtAuthGuard, TenantGuard)\n@ApiBearerAuth()\nexport class DocumentsController {\n    constructor(private readonly documentService: DocumentService) {}\n\n    @Get()\n    @ApiOperation({ summary: 'Get all documents' })\n    @ApiResponse({ status: 200, description: 'Documents retrieved' })\n    async findAll(\n        @Query() filters: DocumentFiltersDto,\n        @Req() req: any\n    ): Promise<{ data: any[]; total: number; page: number; limit: number }> {\n        const tenantId = req.user?.tenant_id;\n        return this.documentService.findAll(tenantId, filters);\n    }\n\n    @Get('statistics')\n    @ApiOperation({ summary: 'Get document statistics' })\n    @ApiResponse({ status: 200, description: 'Statistics retrieved' })\n    async getStatistics(@Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.documentService.getStatistics(tenantId);\n    }\n\n    @Get(':id')\n    @ApiOperation({ summary: 'Get document by ID' })\n    @ApiResponse({ status: 200, description: 'Document retrieved' })\n    async findById(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.documentService.findById(tenantId, id);\n    }\n\n    @Post('upload')\n    @UseGuards(RbacGuard)\n    @UseInterceptors(FileInterceptor('file'))\n    @ApiConsumes('multipart/form-data')\n    @ApiOperation({ summary: 'Upload document' })\n    @ApiResponse({ status: 201, description: 'Document uploaded' })\n    @Audit('create')\n    async upload(\n        @UploadedFile() file: Express.Multer.File,\n        @Body() dto: UploadDocumentDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.documentService.upload(tenantId, userId, file, dto);\n    }\n\n    @Post('bulk-upload')\n    @UseGuards(RbacGuard)\n    @UseInterceptors(FileInterceptor('files'))\n    @ApiConsumes('multipart/form-data')\n    @ApiOperation({ summary: 'Bulk upload documents' })\n    @ApiResponse({ status: 201, description: 'Documents uploaded' })\n    async bulkUpload(\n        @UploadedFile() files: Express.Multer.File[],\n        @Body() dto: BulkUploadDocumentsDto,\n        @Req() req: any\n    ): Promise<{ success: number; failed: number; documents: any[] }> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.documentService.bulkUpload(tenantId, userId, files, dto.documents);\n    }\n\n    @Put(':id')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update document metadata' })\n    @ApiResponse({ status: 200, description: 'Document updated' })\n    @Audit('update')\n    async update(\n        @Param('id') id: string,\n        @Body() dto: UpdateDocumentDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.documentService.update(tenantId, id, userId, dto);\n    }\n\n    @Post(':id/sign')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Sign document' })\n    @ApiResponse({ status: 200, description: 'Document signed' })\n    @Audit('update')\n    async sign(\n        @Param('id') id: string,\n        @Body() dto: SignDocumentDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.documentService.sign(tenantId, id, userId, dto);\n    }\n\n    @Post(':id/signed-url')\n    @ApiOperation({ summary: 'Generate time-limited signed URL' })\n    @ApiResponse({ status: 200, description: 'Signed URL generated' })\n    async generateSignedUrl(\n        @Param('id') id: string,\n        @Body() dto: GenerateSignedUrlDto,\n        @Req() req: any\n    ): Promise<{ url: string; expiresAt: Date }> {\n        const tenantId = req.user?.tenant_id;\n        return this.documentService.generateSignedUrl(tenantId, id, dto);\n    }\n\n    @Delete(':id')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete document' })\n    @ApiResponse({ status: 204, description: 'Document deleted' })\n    @Audit('delete')\n    async delete(@Param('id') id: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.documentService.delete(tenantId, id, userId);\n    }\n}\n"],"names":["DocumentsController","findAll","filters","req","tenantId","user","tenant_id","documentService","getStatistics","findById","id","upload","file","dto","userId","user_id","bulkUpload","files","documents","update","sign","generateSignedUrl","delete","summary","status","description","NO_CONTENT"],"mappings":"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"}