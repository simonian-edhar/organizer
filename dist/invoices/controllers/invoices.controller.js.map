{"version":3,"sources":["../../../src/invoices/controllers/invoices.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Get,\n    Post,\n    Put,\n    Delete,\n    Body,\n    Param,\n    Query,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\nReq, } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiParam, ApiQuery } from '@nestjs/swagger';\nimport { InvoiceService } from '../services/invoice.service';\nimport {\n    CreateInvoiceDto,\n    UpdateInvoiceDto,\n    InvoiceFiltersDto,\n    GenerateInvoicePdfDto,\n    RecordPaymentDto,\n} from '../dto/invoice.dto';\nimport { JwtAuthGuard } from '../../auth/guards';\nimport { TenantGuard, RbacGuard } from '../../auth/guards';\nimport { Audit } from '../../auth/services/audit.service';\n\n/**\n * Invoices Controller\n */\n@ApiTags('Invoices')\n@Controller('invoices')\n@UseGuards(JwtAuthGuard, TenantGuard)\n@ApiBearerAuth()\nexport class InvoicesController {\n    constructor(private readonly invoiceService: InvoiceService) {}\n\n    @Get()\n    @ApiOperation({ summary: 'Get all invoices' })\n    @ApiResponse({ status: 200, description: 'Invoices retrieved' })\n    async findAll(\n        @Query() filters: InvoiceFiltersDto,\n        @Req() req: any\n    ): Promise<{ data: any[]; total: number; page: number; limit: number }> {\n        const tenantId = req.user?.tenant_id;\n        return this.invoiceService.findAll(tenantId, filters);\n    }\n\n    @Get('statistics')\n    @ApiOperation({ summary: 'Get invoice statistics' })\n    @ApiResponse({ status: 200, description: 'Statistics retrieved' })\n    async getStatistics(@Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.invoiceService.getStatistics(tenantId);\n    }\n\n    @Get(':id')\n    @ApiOperation({ summary: 'Get invoice by ID' })\n    @ApiResponse({ status: 200, description: 'Invoice retrieved' })\n    async findById(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.invoiceService.findById(tenantId, id);\n    }\n\n    @Post()\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Create new invoice' })\n    @ApiResponse({ status: 201, description: 'Invoice created' })\n    @Audit('create')\n    async create(@Body() dto: CreateInvoiceDto, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.invoiceService.create(tenantId, userId, dto);\n    }\n\n    @Put(':id')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update invoice' })\n    @ApiResponse({ status: 200, description: 'Invoice updated' })\n    @Audit('update')\n    async update(\n        @Param('id') id: string,\n        @Body() dto: UpdateInvoiceDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.invoiceService.update(tenantId, id, userId, dto);\n    }\n\n    @Post(':id/send')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Send invoice to client' })\n    @ApiResponse({ status: 200, description: 'Invoice sent' })\n    @Audit('update')\n    async send(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.invoiceService.send(tenantId, id, userId);\n    }\n\n    @Post(':id/pdf')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Generate invoice PDF' })\n    @ApiResponse({ status: 200, description: 'PDF generated' })\n    @Audit('update')\n    async generatePdf(\n        @Param('id') id: string,\n        @Body() dto: GenerateInvoicePdfDto,\n        @Req() req: any\n    ): Promise<{ pdfUrl: string; pdfGeneratedAt: Date }> {\n        const tenantId = req.user?.tenant_id;\n        return this.invoiceService.generatePdf(tenantId, id, dto);\n    }\n\n    @Post(':id/payment')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Record payment' })\n    @ApiResponse({ status: 200, description: 'Payment recorded' })\n    @Audit('update')\n    async recordPayment(\n        @Param('id') id: string,\n        @Body() dto: RecordPaymentDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.invoiceService.recordPayment(tenantId, id, userId, dto);\n    }\n\n    @Delete(':id')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete invoice' })\n    @ApiResponse({ status: 204, description: 'Invoice deleted' })\n    @Audit('delete')\n    async delete(@Param('id') id: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.invoiceService.delete(tenantId, id, userId);\n    }\n}\n"],"names":["InvoicesController","findAll","filters","req","tenantId","user","tenant_id","invoiceService","getStatistics","findById","id","create","dto","userId","user_id","update","send","generatePdf","recordPayment","delete","summary","status","description","NO_CONTENT"],"mappings":"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"}