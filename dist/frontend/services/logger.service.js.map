{"version":3,"sources":["../../../src/frontend/services/logger.service.ts"],"sourcesContent":["/**\n * Logger Service\n * Centralized logging for the frontend application\n * Tracks errors, user actions, and performance metrics\n */\n\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'fatal';\n\nexport interface LogEntry {\n    timestamp: string;\n    level: LogLevel;\n    message: string;\n    context?: string;\n    userId?: string;\n    tenantId?: string;\n    url?: string;\n    userAgent?: string;\n    metadata?: Record<string, any>;\n    error?: {\n        name: string;\n        message: string;\n        stack?: string;\n    };\n}\n\nexport interface LoggerConfig {\n    enabled: boolean;\n    minLevel: LogLevel;\n    logToConsole: boolean;\n    logToServer: boolean;\n    serverEndpoint?: string;\n    batchSize: number;\n    flushInterval: number; // ms\n}\n\nconst LOG_LEVELS: Record<LogLevel, number> = {\n    debug: 0,\n    info: 1,\n    warn: 2,\n    error: 3,\n    fatal: 4,\n};\n\nclass LoggerService {\n    private config: LoggerConfig = {\n        enabled: true,\n        minLevel: 'info',\n        logToConsole: true,\n        logToServer: true,\n        serverEndpoint: '/api/logs',\n        batchSize: 10,\n        flushInterval: 30000, // 30 seconds\n    };\n\n    private logBuffer: LogEntry[] = [];\n    private flushTimer: ReturnType<typeof setInterval> | null = null;\n    private userId: string | null = null;\n    private tenantId: string | null = null;\n\n    constructor() {\n        this.startFlushTimer();\n        this.setupErrorHandlers();\n    }\n\n    /**\n     * Configure the logger\n     */\n    configure(config: Partial<LoggerConfig>): void {\n        this.config = { ...this.config, ...config };\n    }\n\n    /**\n     * Set user context\n     */\n    setUser(userId: string | null, tenantId?: string | null): void {\n        this.userId = userId;\n        this.tenantId = tenantId || null;\n    }\n\n    /**\n     * Log debug message\n     */\n    debug(message: string, context?: string, metadata?: Record<string, any>): void {\n        this.log('debug', message, context, metadata);\n    }\n\n    /**\n     * Log info message\n     */\n    info(message: string, context?: string, metadata?: Record<string, any>): void {\n        this.log('info', message, context, metadata);\n    }\n\n    /**\n     * Log warning message\n     */\n    warn(message: string, context?: string, metadata?: Record<string, any>): void {\n        this.log('warn', message, context, metadata);\n    }\n\n    /**\n     * Log error message\n     */\n    error(message: string, error?: Error, context?: string, metadata?: Record<string, any>): void {\n        this.log('error', message, context, metadata, error);\n    }\n\n    /**\n     * Log fatal error\n     */\n    fatal(message: string, error?: Error, context?: string, metadata?: Record<string, any>): void {\n        this.log('fatal', message, context, metadata, error);\n    }\n\n    /**\n     * Log user action\n     */\n    userAction(action: string, details?: Record<string, any>): void {\n        this.log('info', `User action: ${action}`, 'UserAction', {\n            action,\n            ...details,\n        });\n    }\n\n    /**\n     * Log page view\n     */\n    pageView(pageName: string, path?: string): void {\n        this.log('info', `Page view: ${pageName}`, 'PageView', {\n            pageName,\n            path: path || window.location.pathname,\n            referrer: document.referrer,\n        });\n    }\n\n    /**\n     * Log API call\n     */\n    apiCall(method: string, url: string, duration: number, status: number, error?: string): void {\n        const level = status >= 400 ? 'error' : 'info';\n        this.log(level, `API ${method} ${url}`, 'APICall', {\n            method,\n            url,\n            duration,\n            status,\n            error,\n        });\n    }\n\n    /**\n     * Log performance metric\n     */\n    performance(metric: string, value: number, unit: string = 'ms'): void {\n        this.log('info', `Performance: ${metric}`, 'Performance', {\n            metric,\n            value,\n            unit,\n        });\n    }\n\n    /**\n     * Core logging method\n     */\n    private log(\n        level: LogLevel,\n        message: string,\n        context?: string,\n        metadata?: Record<string, any>,\n        error?: Error\n    ): void {\n        if (!this.config.enabled) return;\n        if (LOG_LEVELS[level] < LOG_LEVELS[this.config.minLevel]) return;\n\n        const entry: LogEntry = {\n            timestamp: new Date().toISOString(),\n            level,\n            message,\n            context,\n            userId: this.userId || undefined,\n            tenantId: this.tenantId || undefined,\n            url: window.location.href,\n            userAgent: navigator.userAgent,\n            metadata,\n        };\n\n        if (error) {\n            entry.error = {\n                name: error.name,\n                message: error.message,\n                stack: error.stack,\n            };\n        }\n\n        // Console output\n        if (this.config.logToConsole) {\n            this.logToConsole(entry);\n        }\n\n        // Buffer for server logging\n        if (this.config.logToServer) {\n            this.logBuffer.push(entry);\n            if (this.logBuffer.length >= this.config.batchSize) {\n                this.flush();\n            }\n        }\n    }\n\n    /**\n     * Output to console with formatting\n     */\n    private logToConsole(entry: LogEntry): void {\n        const prefix = `[${entry.timestamp}] [${entry.level.toUpperCase()}]`;\n        const contextStr = entry.context ? ` [${entry.context}]` : '';\n        const fullMessage = `${prefix}${contextStr} ${entry.message}`;\n\n        switch (entry.level) {\n            case 'debug':\n                console.debug(fullMessage, entry.metadata || '');\n                break;\n            case 'info':\n                console.info(fullMessage, entry.metadata || '');\n                break;\n            case 'warn':\n                console.warn(fullMessage, entry.metadata || '');\n                break;\n            case 'error':\n            case 'fatal':\n                console.error(fullMessage, entry.error || entry.metadata || '');\n                break;\n        }\n    }\n\n    /**\n     * Flush logs to server\n     */\n    async flush(): Promise<void> {\n        if (this.logBuffer.length === 0) return;\n        if (!this.config.logToServer) return;\n\n        const logsToSend = [...this.logBuffer];\n        this.logBuffer = [];\n\n        try {\n            const response = await fetch(this.config.serverEndpoint || '/api/logs', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`,\n                },\n                body: JSON.stringify({ logs: logsToSend }),\n            });\n\n            if (!response.ok) {\n                // Re-add logs to buffer on failure\n                this.logBuffer = [...logsToSend, ...this.logBuffer].slice(0, 100); // Limit buffer size\n            }\n        } catch (error) {\n            // Silently fail and keep logs in buffer\n            this.logBuffer = [...logsToSend, ...this.logBuffer].slice(0, 100);\n        }\n    }\n\n    /**\n     * Start periodic flush timer\n     */\n    private startFlushTimer(): void {\n        if (this.flushTimer) {\n            clearInterval(this.flushTimer);\n        }\n        this.flushTimer = setInterval(() => {\n            this.flush();\n        }, this.config.flushInterval);\n\n        // Flush on page unload\n        window.addEventListener('beforeunload', () => {\n            this.flush();\n        });\n    }\n\n    /**\n     * Setup global error handlers\n     */\n    private setupErrorHandlers(): void {\n        // Handle uncaught errors\n        window.addEventListener('error', (event) => {\n            this.error(\n                'Uncaught error',\n                event.error || new Error(event.message),\n                'GlobalErrorHandler',\n                {\n                    filename: event.filename,\n                    lineno: event.lineno,\n                    colno: event.colno,\n                }\n            );\n        });\n\n        // Handle unhandled promise rejections\n        window.addEventListener('unhandledrejection', (event) => {\n            const error = event.reason instanceof Error\n                ? event.reason\n                : new Error(String(event.reason));\n\n            this.error(\n                'Unhandled promise rejection',\n                error,\n                'PromiseRejectionHandler'\n            );\n        });\n    }\n\n    /**\n     * Get all buffered logs\n     */\n    getBufferedLogs(): LogEntry[] {\n        return [...this.logBuffer];\n    }\n\n    /**\n     * Clear log buffer\n     */\n    clearBuffer(): void {\n        this.logBuffer = [];\n    }\n}\n\n// Export singleton instance\nexport const logger = new LoggerService();\n\n// Export type for dependency injection\nexport type Logger = typeof logger;\n"],"names":["logger","LOG_LEVELS","debug","info","warn","error","fatal","LoggerService","configure","config","setUser","userId","tenantId","message","context","metadata","log","userAction","action","details","pageView","pageName","path","window","location","pathname","referrer","document","apiCall","method","url","duration","status","level","performance","metric","value","unit","enabled","minLevel","entry","timestamp","Date","toISOString","undefined","href","userAgent","navigator","name","stack","logToConsole","logToServer","logBuffer","push","length","batchSize","flush","prefix","toUpperCase","contextStr","fullMessage","console","logsToSend","response","fetch","serverEndpoint","headers","localStorage","getItem","body","JSON","stringify","logs","ok","slice","startFlushTimer","flushTimer","clearInterval","setInterval","flushInterval","addEventListener","setupErrorHandlers","event","Error","filename","lineno","colno","reason","String","getBufferedLogs","clearBuffer"],"mappings":"AAAA;;;;CAIC;;;;+BAmUYA;;;eAAAA;;;AApSb,MAAMC,aAAuC;IACzCC,OAAO;IACPC,MAAM;IACNC,MAAM;IACNC,OAAO;IACPC,OAAO;AACX;AAEA,IAAA,AAAMC,gBAAN,MAAMA;IAqBF;;KAEC,GACDC,UAAUC,MAA6B,EAAQ;QAC3C,IAAI,CAACA,MAAM,GAAG;YAAE,GAAG,IAAI,CAACA,MAAM;YAAE,GAAGA,MAAM;QAAC;IAC9C;IAEA;;KAEC,GACDC,QAAQC,MAAqB,EAAEC,QAAwB,EAAQ;QAC3D,IAAI,CAACD,MAAM,GAAGA;QACd,IAAI,CAACC,QAAQ,GAAGA,YAAY;IAChC;IAEA;;KAEC,GACDV,MAAMW,OAAe,EAAEC,OAAgB,EAAEC,QAA8B,EAAQ;QAC3E,IAAI,CAACC,GAAG,CAAC,SAASH,SAASC,SAASC;IACxC;IAEA;;KAEC,GACDZ,KAAKU,OAAe,EAAEC,OAAgB,EAAEC,QAA8B,EAAQ;QAC1E,IAAI,CAACC,GAAG,CAAC,QAAQH,SAASC,SAASC;IACvC;IAEA;;KAEC,GACDX,KAAKS,OAAe,EAAEC,OAAgB,EAAEC,QAA8B,EAAQ;QAC1E,IAAI,CAACC,GAAG,CAAC,QAAQH,SAASC,SAASC;IACvC;IAEA;;KAEC,GACDV,MAAMQ,OAAe,EAAER,KAAa,EAAES,OAAgB,EAAEC,QAA8B,EAAQ;QAC1F,IAAI,CAACC,GAAG,CAAC,SAASH,SAASC,SAASC,UAAUV;IAClD;IAEA;;KAEC,GACDC,MAAMO,OAAe,EAAER,KAAa,EAAES,OAAgB,EAAEC,QAA8B,EAAQ;QAC1F,IAAI,CAACC,GAAG,CAAC,SAASH,SAASC,SAASC,UAAUV;IAClD;IAEA;;KAEC,GACDY,WAAWC,MAAc,EAAEC,OAA6B,EAAQ;QAC5D,IAAI,CAACH,GAAG,CAAC,QAAQ,CAAC,aAAa,EAAEE,QAAQ,EAAE,cAAc;YACrDA;YACA,GAAGC,OAAO;QACd;IACJ;IAEA;;KAEC,GACDC,SAASC,QAAgB,EAAEC,IAAa,EAAQ;QAC5C,IAAI,CAACN,GAAG,CAAC,QAAQ,CAAC,WAAW,EAAEK,UAAU,EAAE,YAAY;YACnDA;YACAC,MAAMA,QAAQC,OAAOC,QAAQ,CAACC,QAAQ;YACtCC,UAAUC,SAASD,QAAQ;QAC/B;IACJ;IAEA;;KAEC,GACDE,QAAQC,MAAc,EAAEC,GAAW,EAAEC,QAAgB,EAAEC,MAAc,EAAE3B,KAAc,EAAQ;QACzF,MAAM4B,QAAQD,UAAU,MAAM,UAAU;QACxC,IAAI,CAAChB,GAAG,CAACiB,OAAO,CAAC,IAAI,EAAEJ,OAAO,CAAC,EAAEC,KAAK,EAAE,WAAW;YAC/CD;YACAC;YACAC;YACAC;YACA3B;QACJ;IACJ;IAEA;;KAEC,GACD6B,YAAYC,MAAc,EAAEC,KAAa,EAAEC,OAAe,IAAI,EAAQ;QAClE,IAAI,CAACrB,GAAG,CAAC,QAAQ,CAAC,aAAa,EAAEmB,QAAQ,EAAE,eAAe;YACtDA;YACAC;YACAC;QACJ;IACJ;IAEA;;KAEC,GACD,AAAQrB,IACJiB,KAAe,EACfpB,OAAe,EACfC,OAAgB,EAChBC,QAA8B,EAC9BV,KAAa,EACT;QACJ,IAAI,CAAC,IAAI,CAACI,MAAM,CAAC6B,OAAO,EAAE;QAC1B,IAAIrC,UAAU,CAACgC,MAAM,GAAGhC,UAAU,CAAC,IAAI,CAACQ,MAAM,CAAC8B,QAAQ,CAAC,EAAE;QAE1D,MAAMC,QAAkB;YACpBC,WAAW,IAAIC,OAAOC,WAAW;YACjCV;YACApB;YACAC;YACAH,QAAQ,IAAI,CAACA,MAAM,IAAIiC;YACvBhC,UAAU,IAAI,CAACA,QAAQ,IAAIgC;YAC3Bd,KAAKP,OAAOC,QAAQ,CAACqB,IAAI;YACzBC,WAAWC,UAAUD,SAAS;YAC9B/B;QACJ;QAEA,IAAIV,OAAO;YACPmC,MAAMnC,KAAK,GAAG;gBACV2C,MAAM3C,MAAM2C,IAAI;gBAChBnC,SAASR,MAAMQ,OAAO;gBACtBoC,OAAO5C,MAAM4C,KAAK;YACtB;QACJ;QAEA,iBAAiB;QACjB,IAAI,IAAI,CAACxC,MAAM,CAACyC,YAAY,EAAE;YAC1B,IAAI,CAACA,YAAY,CAACV;QACtB;QAEA,4BAA4B;QAC5B,IAAI,IAAI,CAAC/B,MAAM,CAAC0C,WAAW,EAAE;YACzB,IAAI,CAACC,SAAS,CAACC,IAAI,CAACb;YACpB,IAAI,IAAI,CAACY,SAAS,CAACE,MAAM,IAAI,IAAI,CAAC7C,MAAM,CAAC8C,SAAS,EAAE;gBAChD,IAAI,CAACC,KAAK;YACd;QACJ;IACJ;IAEA;;KAEC,GACD,AAAQN,aAAaV,KAAe,EAAQ;QACxC,MAAMiB,SAAS,CAAC,CAAC,EAAEjB,MAAMC,SAAS,CAAC,GAAG,EAAED,MAAMP,KAAK,CAACyB,WAAW,GAAG,CAAC,CAAC;QACpE,MAAMC,aAAanB,MAAM1B,OAAO,GAAG,CAAC,EAAE,EAAE0B,MAAM1B,OAAO,CAAC,CAAC,CAAC,GAAG;QAC3D,MAAM8C,cAAc,GAAGH,SAASE,WAAW,CAAC,EAAEnB,MAAM3B,OAAO,EAAE;QAE7D,OAAQ2B,MAAMP,KAAK;YACf,KAAK;gBACD4B,QAAQ3D,KAAK,CAAC0D,aAAapB,MAAMzB,QAAQ,IAAI;gBAC7C;YACJ,KAAK;gBACD8C,QAAQ1D,IAAI,CAACyD,aAAapB,MAAMzB,QAAQ,IAAI;gBAC5C;YACJ,KAAK;gBACD8C,QAAQzD,IAAI,CAACwD,aAAapB,MAAMzB,QAAQ,IAAI;gBAC5C;YACJ,KAAK;YACL,KAAK;gBACD8C,QAAQxD,KAAK,CAACuD,aAAapB,MAAMnC,KAAK,IAAImC,MAAMzB,QAAQ,IAAI;gBAC5D;QACR;IACJ;IAEA;;KAEC,GACD,MAAMyC,QAAuB;QACzB,IAAI,IAAI,CAACJ,SAAS,CAACE,MAAM,KAAK,GAAG;QACjC,IAAI,CAAC,IAAI,CAAC7C,MAAM,CAAC0C,WAAW,EAAE;QAE9B,MAAMW,aAAa;eAAI,IAAI,CAACV,SAAS;SAAC;QACtC,IAAI,CAACA,SAAS,GAAG,EAAE;QAEnB,IAAI;YACA,MAAMW,WAAW,MAAMC,MAAM,IAAI,CAACvD,MAAM,CAACwD,cAAc,IAAI,aAAa;gBACpEpC,QAAQ;gBACRqC,SAAS;oBACL,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAEC,aAAaC,OAAO,CAAC,iBAAiB;gBACrE;gBACAC,MAAMC,KAAKC,SAAS,CAAC;oBAAEC,MAAMV;gBAAW;YAC5C;YAEA,IAAI,CAACC,SAASU,EAAE,EAAE;gBACd,mCAAmC;gBACnC,IAAI,CAACrB,SAAS,GAAG;uBAAIU;uBAAe,IAAI,CAACV,SAAS;iBAAC,CAACsB,KAAK,CAAC,GAAG,MAAM,oBAAoB;YAC3F;QACJ,EAAE,OAAOrE,OAAO;YACZ,wCAAwC;YACxC,IAAI,CAAC+C,SAAS,GAAG;mBAAIU;mBAAe,IAAI,CAACV,SAAS;aAAC,CAACsB,KAAK,CAAC,GAAG;QACjE;IACJ;IAEA;;KAEC,GACD,AAAQC,kBAAwB;QAC5B,IAAI,IAAI,CAACC,UAAU,EAAE;YACjBC,cAAc,IAAI,CAACD,UAAU;QACjC;QACA,IAAI,CAACA,UAAU,GAAGE,YAAY;YAC1B,IAAI,CAACtB,KAAK;QACd,GAAG,IAAI,CAAC/C,MAAM,CAACsE,aAAa;QAE5B,uBAAuB;QACvBxD,OAAOyD,gBAAgB,CAAC,gBAAgB;YACpC,IAAI,CAACxB,KAAK;QACd;IACJ;IAEA;;KAEC,GACD,AAAQyB,qBAA2B;QAC/B,yBAAyB;QACzB1D,OAAOyD,gBAAgB,CAAC,SAAS,CAACE;YAC9B,IAAI,CAAC7E,KAAK,CACN,kBACA6E,MAAM7E,KAAK,IAAI,IAAI8E,MAAMD,MAAMrE,OAAO,GACtC,sBACA;gBACIuE,UAAUF,MAAME,QAAQ;gBACxBC,QAAQH,MAAMG,MAAM;gBACpBC,OAAOJ,MAAMI,KAAK;YACtB;QAER;QAEA,sCAAsC;QACtC/D,OAAOyD,gBAAgB,CAAC,sBAAsB,CAACE;YAC3C,MAAM7E,QAAQ6E,MAAMK,MAAM,YAAYJ,QAChCD,MAAMK,MAAM,GACZ,IAAIJ,MAAMK,OAAON,MAAMK,MAAM;YAEnC,IAAI,CAAClF,KAAK,CACN,+BACAA,OACA;QAER;IACJ;IAEA;;KAEC,GACDoF,kBAA8B;QAC1B,OAAO;eAAI,IAAI,CAACrC,SAAS;SAAC;IAC9B;IAEA;;KAEC,GACDsC,cAAoB;QAChB,IAAI,CAACtC,SAAS,GAAG,EAAE;IACvB;IAxQA,aAAc;aAfN3C,SAAuB;YAC3B6B,SAAS;YACTC,UAAU;YACVW,cAAc;YACdC,aAAa;YACbc,gBAAgB;YAChBV,WAAW;YACXwB,eAAe;QACnB;aAEQ3B,YAAwB,EAAE;aAC1BwB,aAAoD;aACpDjE,SAAwB;aACxBC,WAA0B;QAG9B,IAAI,CAAC+D,eAAe;QACpB,IAAI,CAACM,kBAAkB;IAC3B;AAsQJ;AAGO,MAAMjF,SAAS,IAAIO"}