{"version":3,"sources":["../../../src/frontend/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { RootState } from '../store';\nimport { setUser, clearUser } from '../store/auth.slice';\nimport { authService } from '../services/auth.service';\nimport {\n    LoginCredentials,\n    RegisterCredentials,\n    AuthResponse,\n    User,\n} from '../types/auth.types';\n\n/**\n * Use Auth Hook\n */\nexport const useAuth = () => {\n    const dispatch = useDispatch();\n    const user = useSelector((state: RootState) => state.auth.user);\n    const organization = useSelector((state: RootState) => state.auth.organization);\n    const isAuthenticated = useSelector((state: RootState) => state.auth.isAuthenticated);\n    const isLoading = useSelector((state: RootState) => state.auth.isLoading);\n    const error = useSelector((state: RootState) => state.auth.error);\n\n    /**\n     * Login\n     */\n    const login = useCallback(async (credentials: LoginCredentials): Promise<void> => {\n        try {\n            const response: AuthResponse = await authService.login(credentials);\n\n            // Store tokens\n            authService.setTokens(response);\n\n            // Update Redux state\n            dispatch(setUser({\n                user: response.user,\n                organization: response.organization,\n                isAuthenticated: true,\n            }));\n\n            return;\n        } catch (error: any) {\n            throw error;\n        }\n    }, [dispatch]);\n\n    /**\n     * Register - Simple registration with auto-login\n     */\n    const register = useCallback(async (credentials: RegisterCredentials): Promise<void> => {\n        try {\n            const response: AuthResponse = await authService.register(credentials);\n\n            // Store tokens (already done in authService, but ensure here too)\n            authService.setTokens(response);\n\n            // Update Redux state if user data is returned\n            if (response.user) {\n                dispatch(setUser({\n                    user: response.user,\n                    organization: response.organization,\n                    isAuthenticated: true,\n                }));\n            }\n        } catch (error: any) {\n            throw error;\n        }\n    }, [dispatch]);\n\n    /**\n     * Logout\n     */\n    const logout = useCallback(async (): Promise<void> => {\n        try {\n            await authService.logout();\n        } catch (error) {\n            console.error('Logout error:', error);\n        } finally {\n            // Clear tokens\n            authService.clearTokens();\n\n            // Clear Redux state\n            dispatch(clearUser());\n        }\n    }, [dispatch]);\n\n    /**\n     * Logout from all devices\n     */\n    const logoutAll = useCallback(async (): Promise<void> => {\n        try {\n            await authService.logoutAll();\n        } catch (error) {\n            console.error('Logout all error:', error);\n        } finally {\n            // Clear tokens\n            authService.clearTokens();\n\n            // Clear Redux state\n            dispatch(clearUser());\n        }\n    }, [dispatch]);\n\n    /**\n     * Refresh session\n     */\n    const refreshSession = useCallback(async (): Promise<void> => {\n        try {\n            const refreshToken = authService.getRefreshToken();\n            if (!refreshToken) {\n                throw new Error('No refresh token');\n            }\n\n            const response = await authService.refreshToken(refreshToken);\n\n            // Update tokens\n            authService.setTokens({\n                accessToken: response.accessToken,\n                refreshToken: response.refreshToken,\n                expiresIn: response.expiresIn,\n            } as AuthResponse);\n        } catch (error) {\n            console.error('Session refresh error:', error);\n\n            // Clear tokens\n            authService.clearTokens();\n            dispatch(clearUser());\n\n            throw error;\n        }\n    }, [dispatch]);\n\n    /**\n     * Check if user has role\n     */\n    const hasRole = useCallback((roles: string[]): boolean => {\n        return roles.includes(user?.role || '');\n    }, [user?.role]);\n\n    /**\n     * Check if user has permission\n     */\n    const hasPermission = useCallback((permission: string): boolean => {\n        // TODO: Implement permission checking\n        return true;\n    }, []);\n\n    return {\n        user,\n        organization,\n        isAuthenticated,\n        isLoading,\n        error,\n        login,\n        register,\n        logout,\n        logoutAll,\n        refreshSession,\n        hasRole,\n        hasPermission,\n    };\n};\n"],"names":["useAuth","dispatch","useDispatch","user","useSelector","state","auth","organization","isAuthenticated","isLoading","error","login","useCallback","credentials","response","authService","setTokens","setUser","register","logout","console","clearTokens","clearUser","logoutAll","refreshSession","refreshToken","getRefreshToken","Error","accessToken","expiresIn","hasRole","roles","includes","role","hasPermission","permission"],"mappings":"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"}