{"version":3,"sources":["../../../src/events/controllers/events.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Get,\n    Post,\n    Put,\n    Delete,\n    Body,\n    Param,\n    Query,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\nReq, } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiParam, ApiQuery } from '@nestjs/swagger';\nimport { EventService } from '../services/event.service';\nimport { CreateEventDto, UpdateEventDto, EventFiltersDto } from '../dto/event.dto';\nimport { JwtAuthGuard } from '../../auth/guards';\nimport { TenantGuard, RbacGuard } from '../../auth/guards';\nimport { Audit } from '../../auth/services/audit.service';\n\n/**\n * Events Controller\n */\n@ApiTags('Events')\n@Controller('events')\n@UseGuards(JwtAuthGuard, TenantGuard)\n@ApiBearerAuth()\nexport class EventsController {\n    constructor(private readonly eventService: EventService) {}\n\n    @Get()\n    @ApiOperation({ summary: 'Get all events' })\n    @ApiResponse({ status: 200, description: 'Events retrieved' })\n    async findAll(\n        @Query() filters: EventFiltersDto,\n        @Req() req: any\n    ): Promise<{ data: any[]; total: number; page: number; limit: number }> {\n        const tenantId = req.user?.tenant_id;\n        return this.eventService.findAll(tenantId, filters);\n    }\n\n    @Get('statistics')\n    @ApiOperation({ summary: 'Get event statistics' })\n    @ApiResponse({ status: 200, description: 'Statistics retrieved' })\n    async getStatistics(@Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.eventService.getStatistics(tenantId);\n    }\n\n    @Get('upcoming')\n    @ApiOperation({ summary: 'Get upcoming events' })\n    @ApiResponse({ status: 200, description: 'Upcoming events retrieved' })\n    async getUpcoming(\n        @Query('days') days?: string,\n        @Req() req: any\n    ): Promise<any[]> {\n        const tenantId = req.user?.tenant_id;\n        return this.eventService.getUpcoming(tenantId, days ? parseInt(days) : 30);\n    }\n\n    @Get('calendar')\n    @ApiOperation({ summary: 'Get calendar events for integration' })\n    @ApiResponse({ status: 200, description: 'Calendar events retrieved' })\n    async getCalendarEvents(\n        @Query('startDate') startDate: string,\n        @Query('endDate') endDate: string,\n        @Req() req: any\n    ): Promise<any[]> {\n        const tenantId = req.user?.tenant_id;\n        return this.eventService.getCalendarEvents(\n            tenantId,\n            new Date(startDate),\n            new Date(endDate)\n        );\n    }\n\n    @Get(':id')\n    @ApiOperation({ summary: 'Get event by ID' })\n    @ApiResponse({ status: 200, description: 'Event retrieved' })\n    async findById(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.eventService.findById(tenantId, id);\n    }\n\n    @Post()\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Create new event' })\n    @ApiResponse({ status: 201, description: 'Event created' })\n    @Audit('create')\n    async create(@Body() dto: CreateEventDto, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.eventService.create(tenantId, userId, dto);\n    }\n\n    @Put(':id')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update event' })\n    @ApiResponse({ status: 200, description: 'Event updated' })\n    @Audit('update')\n    async update(\n        @Param('id') id: string,\n        @Body() dto: UpdateEventDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.eventService.update(tenantId, id, userId, dto);\n    }\n\n    @Delete(':id')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete event' })\n    @ApiResponse({ status: 204, description: 'Event deleted' })\n    @Audit('delete')\n    async delete(@Param('id') id: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.eventService.delete(tenantId, id, userId);\n    }\n}\n"],"names":["EventsController","findAll","filters","req","tenantId","user","tenant_id","eventService","getStatistics","getUpcoming","days","parseInt","getCalendarEvents","startDate","endDate","Date","findById","id","create","dto","userId","user_id","update","delete","summary","status","description","NO_CONTENT"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAfD;yBAC0E;8BACzD;0BACmC;wBACnC;8BAEP;;;;;;;;;;;;;;;AASf,IAAA,AAAMA,mBAAN,MAAMA;IAGT,MAGMC,QACF,AAASC,OAAwB,EACjC,AAAOC,GAAQ,EACqD;QACpE,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,OAAO,IAAI,CAACC,YAAY,CAACN,OAAO,CAACG,UAAUF;IAC/C;IAEA,MAGMM,cAAc,AAAOL,GAAQ,EAAgB;QAC/C,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,OAAO,IAAI,CAACC,YAAY,CAACC,aAAa,CAACJ;IAC3C;IAEA,MAGMK,YACF,AAAeC,IAAa,EAC5B,AAAOP,GAAQ,EACD;QACd,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,OAAO,IAAI,CAACC,YAAY,CAACE,WAAW,CAACL,UAAUM,OAAOC,SAASD,QAAQ;IAC3E;IAEA,MAGME,kBACF,AAAoBC,SAAiB,EACrC,AAAkBC,OAAe,EACjC,AAAOX,GAAQ,EACD;QACd,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,OAAO,IAAI,CAACC,YAAY,CAACK,iBAAiB,CACtCR,UACA,IAAIW,KAAKF,YACT,IAAIE,KAAKD;IAEjB;IAEA,MAGME,SAAS,AAAaC,EAAU,EAAE,AAAOd,GAAQ,EAAgB;QACnE,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,OAAO,IAAI,CAACC,YAAY,CAACS,QAAQ,CAACZ,UAAUa;IAChD;IAEA,MAKMC,OAAO,AAAQC,GAAmB,EAAE,AAAOhB,GAAQ,EAAgB;QACrE,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,MAAMc,SAASjB,IAAIE,IAAI,EAAEgB;QACzB,OAAO,IAAI,CAACd,YAAY,CAACW,MAAM,CAACd,UAAUgB,QAAQD;IACtD;IAEA,MAKMG,OACF,AAAaL,EAAU,EACvB,AAAQE,GAAmB,EAC3B,AAAOhB,GAAQ,EACH;QACZ,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,MAAMc,SAASjB,IAAIE,IAAI,EAAEgB;QACzB,OAAO,IAAI,CAACd,YAAY,CAACe,MAAM,CAAClB,UAAUa,IAAIG,QAAQD;IAC1D;IAEA,MAMMI,OAAO,AAAaN,EAAU,EAAE,AAAOd,GAAQ,EAAiB;QAClE,MAAMC,WAAWD,IAAIE,IAAI,EAAEC;QAC3B,MAAMc,SAASjB,IAAIE,IAAI,EAAEgB;QACzB,OAAO,IAAI,CAACd,YAAY,CAACgB,MAAM,CAACnB,UAAUa,IAAIG;IAClD;IA5FA,YAAY,AAAiBb,YAA0B,CAAE;aAA5BA,eAAAA;IAA6B;AA6F9D;;;;QA1FoBiB,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAOzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;QAezBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;QAQzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;6CAcpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa"}