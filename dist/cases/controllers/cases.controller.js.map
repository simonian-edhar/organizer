{"version":3,"sources":["../../../src/cases/controllers/cases.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Get,\n    Post,\n    Put,\n    Delete,\n    Body,\n    Param,\n    Query,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\n    Req,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\nimport { CaseService } from '../services/case.service';\nimport { CreateCaseDto, UpdateCaseDto, CaseFiltersDto, AddTimelineEventDto } from '../dto/case.dto';\nimport { JwtAuthGuard } from '../../auth/guards';\nimport { TenantGuard, RbacGuard } from '../../auth/guards';\nimport { Audit } from '../../auth/services/audit.service';\n\n/**\n * Cases Controller\n */\n@ApiTags('Cases')\n@Controller('cases')\n@UseGuards(JwtAuthGuard, TenantGuard)\n@ApiBearerAuth()\nexport class CasesController {\n    constructor(private readonly caseService: CaseService) {}\n\n    @Get()\n    @ApiOperation({ summary: 'Get all cases' })\n    @ApiResponse({ status: 200, description: 'Cases retrieved' })\n    async findAll(\n        @Query() filters: CaseFiltersDto,\n        @Req() req: any\n    ): Promise<{ data: any[]; total: number; page: number; limit: number }> {\n        const tenantId = req.user?.tenant_id;\n        return this.caseService.findAll(tenantId, filters);\n    }\n\n    @Get('statistics')\n    @ApiOperation({ summary: 'Get case statistics' })\n    @ApiResponse({ status: 200, description: 'Statistics retrieved' })\n    async getStatistics(@Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.caseService.getStatistics(tenantId);\n    }\n\n    @Get('upcoming-deadlines')\n    @ApiOperation({ summary: 'Get upcoming deadlines' })\n    @ApiResponse({ status: 200, description: 'Upcoming deadlines retrieved' })\n    async getUpcomingDeadlines(\n        @Query('days') days?: string,\n        @Req() req?: any\n    ): Promise<any[]> {\n        const tenantId = req.user?.tenant_id;\n        return this.caseService.getUpcomingDeadlines(tenantId, days ? parseInt(days) : 30);\n    }\n\n    @Get(':id')\n    @ApiOperation({ summary: 'Get case by ID' })\n    @ApiResponse({ status: 200, description: 'Case retrieved' })\n    async findById(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.caseService.findById(tenantId, id);\n    }\n\n    @Get(':id/timeline')\n    @ApiOperation({ summary: 'Get case timeline' })\n    @ApiResponse({ status: 200, description: 'Timeline retrieved' })\n    async getTimeline(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.caseService.getTimeline(tenantId, id);\n    }\n\n    @Post()\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Create new case' })\n    @ApiResponse({ status: 201, description: 'Case created' })\n    @Audit('create')\n    async create(@Body() dto: CreateCaseDto, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.caseService.create(tenantId, userId, dto);\n    }\n\n    @Put(':id')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update case' })\n    @ApiResponse({ status: 200, description: 'Case updated' })\n    @Audit('update')\n    async update(\n        @Param('id') id: string,\n        @Body() dto: UpdateCaseDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.caseService.update(tenantId, id, userId, dto);\n    }\n\n    @Put(':id/status')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Change case status' })\n    @ApiResponse({ status: 200, description: 'Status changed' })\n    @Audit('update')\n    async changeStatus(\n        @Param('id') id: string,\n        @Body('status') status: 'draft' | 'active' | 'on_hold' | 'closed' | 'archived',\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.caseService.changeStatus(tenantId, id, userId, status);\n    }\n\n    @Post(':id/restore')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Restore deleted case' })\n    @ApiResponse({ status: 200, description: 'Case restored' })\n    async restore(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.caseService.restore(tenantId, id, userId);\n    }\n\n    @Delete(':id')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete case' })\n    @ApiResponse({ status: 204, description: 'Case deleted' })\n    @Audit('delete')\n    async delete(@Param('id') id: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.caseService.delete(tenantId, id, userId);\n    }\n}\n"],"names":["CasesController","findAll","filters","req","tenantId","user","tenant_id","caseService","getStatistics","getUpcomingDeadlines","days","parseInt","findById","id","getTimeline","create","dto","userId","user_id","update","changeStatus","status","restore","delete","summary","description","NO_CONTENT"],"mappings":"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"}