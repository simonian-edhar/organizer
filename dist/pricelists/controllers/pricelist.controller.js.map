{"version":3,"sources":["../../../src/pricelists/controllers/pricelist.controller.ts"],"sourcesContent":["import {\n    Controller,\n    Get,\n    Post,\n    Put,\n    Delete,\n    Body,\n    Param,\n    Query,\n    UseGuards,\n    HttpCode,\n    HttpStatus,\nReq, } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiParam, ApiQuery, ApiBody } from '@nestjs/swagger';\nimport { PricelistService } from '../services/pricelist.service';\nimport {\n    CreatePricelistDto,\n    UpdatePricelistDto,\n    CreatePricelistItemDto,\n    UpdatePricelistItemDto,\n    PricelistFiltersDto,\n} from '../dto/pricelist.dto';\nimport { JwtAuthGuard } from '../../auth/guards';\nimport { TenantGuard, RbacGuard } from '../../auth/guards';\nimport { Audit } from '../../auth/services/audit.service';\n\n/**\n * Pricelists Controller\n */\n@ApiTags('Pricelists')\n@Controller('pricelists')\n@UseGuards(JwtAuthGuard, TenantGuard)\n@ApiBearerAuth()\nexport class PricelistsController {\n    constructor(private readonly pricelistService: PricelistService) {}\n\n    @Get()\n    @ApiOperation({ summary: 'Get all pricelists' })\n    @ApiResponse({ status: 200, description: 'Pricelists retrieved' })\n    async findAll(\n        @Query() filters: PricelistFiltersDto,\n        @Req() req: any\n    ): Promise<{ data: any[]; total: number; page: number; limit: number }> {\n        const tenantId = req.user?.tenant_id;\n        return this.pricelistService.findAll(tenantId, filters);\n    }\n\n    @Get('default')\n    @ApiOperation({ summary: 'Get default pricelist' })\n    @ApiResponse({ status: 200, description: 'Default pricelist retrieved' })\n    async getDefault(@Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.pricelistService.getDefaultPricelist(tenantId);\n    }\n\n    @Get('items')\n    @ApiOperation({ summary: 'Get items by category' })\n    @ApiResponse({ status: 200, description: 'Items retrieved' })\n    async getItemsByCategory(\n        @Query('category') category: string,\n        @Req() req: any\n    ): Promise<any[]> {\n        const tenantId = req.user?.tenant_id;\n        return this.pricelistService.getItemsByCategory(tenantId, category);\n    }\n\n    @Get(':id')\n    @ApiOperation({ summary: 'Get pricelist by ID' })\n    @ApiResponse({ status: 200, description: 'Pricelist retrieved' })\n    async findById(@Param('id') id: string, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        return this.pricelistService.findById(tenantId, id);\n    }\n\n    @Post()\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Create new pricelist' })\n    @ApiResponse({ status: 201, description: 'Pricelist created' })\n    @Audit('create')\n    async create(@Body() dto: CreatePricelistDto, @Req() req: any): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.create(tenantId, userId, dto);\n    }\n\n    @Put(':id')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update pricelist' })\n    @ApiResponse({ status: 200, description: 'Pricelist updated' })\n    @Audit('update')\n    async update(\n        @Param('id') id: string,\n        @Body() dto: UpdatePricelistDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.update(tenantId, id, userId, dto);\n    }\n\n    @Delete(':id')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete pricelist' })\n    @ApiResponse({ status: 204, description: 'Pricelist deleted' })\n    @Audit('delete')\n    async delete(@Param('id') id: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.delete(tenantId, id, userId);\n    }\n\n    @Post(':id/items')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Add item to pricelist' })\n    @ApiResponse({ status: 201, description: 'Item added' })\n    @Audit('create')\n    async addItem(\n        @Param('id') id: string,\n        @Body() dto: CreatePricelistItemDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.addItem(tenantId, userId, id, dto);\n    }\n\n    @Put('items/:itemId')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Update pricelist item' })\n    @ApiResponse({ status: 200, description: 'Item updated' })\n    @Audit('update')\n    async updateItem(\n        @Param('itemId') itemId: string,\n        @Body() dto: UpdatePricelistItemDto,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.updateItem(tenantId, itemId, userId, dto);\n    }\n\n    @Delete('items/:itemId')\n    @UseGuards(RbacGuard)\n    @HttpCode(HttpStatus.NO_CONTENT)\n    @ApiOperation({ summary: 'Delete pricelist item' })\n    @ApiResponse({ status: 204, description: 'Item deleted' })\n    @Audit('delete')\n    async deleteItem(@Param('itemId') itemId: string, @Req() req: any): Promise<void> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n        return this.pricelistService.deleteItem(tenantId, itemId, userId);\n    }\n\n    @Post(':id/duplicate')\n    @UseGuards(RbacGuard)\n    @ApiOperation({ summary: 'Duplicate pricelist' })\n    @ApiResponse({ status: 201, description: 'Pricelist duplicated' })\n    @Audit('create')\n    async duplicate(\n        @Param('id') id: string,\n        @Req() req: any\n    ): Promise<any> {\n        const tenantId = req.user?.tenant_id;\n        const userId = req.user?.user_id;\n\n        const original = await this.pricelistService.findById(tenantId, id);\n\n        const duplicated = await this.pricelistService.create(tenantId, userId, {\n            name: `${original.name} (Копія)`,\n            description: original.description,\n            type: original.type,\n            status: 'active',\n        });\n\n        // Copy items\n        for (const item of original.items) {\n            await this.pricelistService.addItem(tenantId, userId, duplicated.id, {\n                name: item.name,\n                code: item.code,\n                category: item.category,\n                unitType: item.unitType,\n                basePrice: item.basePrice,\n                description: item.description,\n            });\n        }\n\n        return duplicated;\n    }\n}\n"],"names":["PricelistsController","findAll","filters","req","tenantId","user","tenant_id","pricelistService","getDefault","getDefaultPricelist","getItemsByCategory","category","findById","id","create","dto","userId","user_id","update","delete","addItem","updateItem","itemId","deleteItem","duplicate","original","duplicated","name","description","type","status","item","items","code","unitType","basePrice","summary","NO_CONTENT"],"mappings":"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"}