{"version":3,"sources":["../../../../src/enterprise/commands/handlers/create-user.handler.ts"],"sourcesContent":["import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';\nimport { CreateUserCommand } from '../commands/create-user.command';\nimport { User } from '../../database/entities/User.entity';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\n\n/**\n * Create User Command Handler\n * Handles user creation in the write model\n */\n@CommandHandler(CreateUserCommand)\nexport class CreateUserCommandHandler implements ICommandHandler<CreateUserCommand> {\n    constructor(\n        @InjectRepository(User)\n        private readonly userRepository: Repository<User>,\n        private readonly eventBus: EventBus,\n    ) {}\n\n    async execute(command: CreateUserCommand): Promise<User> {\n        // Create user in write model\n        const user = this.userRepository.create({\n            tenantId: command.tenantId,\n            firstName: command.firstName,\n            lastName: command.lastName,\n            email: command.email,\n            passwordHash: command.passwordHash,\n            salt: command.salt,\n            role: command.role,\n            status: 'active',\n        });\n\n        const savedUser = await this.userRepository.save(user);\n\n        // Publish event for read model update\n        this.eventBus.publish(new UserCreatedEvent({\n            userId: savedUser.id,\n            tenantId: savedUser.tenantId,\n            firstName: savedUser.firstName,\n            lastName: savedUser.lastName,\n            email: savedUser.email,\n            role: savedUser.role,\n            createdAt: savedUser.createdAt,\n        }));\n\n        // Publish event for audit logging\n        this.eventBus.publish(new AuditLogEvent({\n            tenantId: savedUser.tenantId,\n            userId: savedUser.id,\n            action: 'create',\n            entityType: 'User',\n            entityId: savedUser.id,\n            newValues: savedUser,\n            timestamp: new Date(),\n        }));\n\n        return savedUser;\n    }\n}\n"],"names":["CreateUserCommandHandler","execute","command","user","userRepository","create","tenantId","firstName","lastName","email","passwordHash","salt","role","status","savedUser","save","eventBus","publish","UserCreatedEvent","userId","id","createdAt","AuditLogEvent","action","entityType","entityId","newValues","timestamp","Date"],"mappings":";;;;+BAWaA;;;eAAAA;;;sBAXmC;mCACd;4BACb;yBACY;0BACN;;;;;;;;;;;;;;;AAOpB,IAAA,AAAMA,2BAAN,MAAMA;IAOT,MAAMC,QAAQC,OAA0B,EAAiB;QACrD,6BAA6B;QAC7B,MAAMC,OAAO,IAAI,CAACC,cAAc,CAACC,MAAM,CAAC;YACpCC,UAAUJ,QAAQI,QAAQ;YAC1BC,WAAWL,QAAQK,SAAS;YAC5BC,UAAUN,QAAQM,QAAQ;YAC1BC,OAAOP,QAAQO,KAAK;YACpBC,cAAcR,QAAQQ,YAAY;YAClCC,MAAMT,QAAQS,IAAI;YAClBC,MAAMV,QAAQU,IAAI;YAClBC,QAAQ;QACZ;QAEA,MAAMC,YAAY,MAAM,IAAI,CAACV,cAAc,CAACW,IAAI,CAACZ;QAEjD,sCAAsC;QACtC,IAAI,CAACa,QAAQ,CAACC,OAAO,CAAC,IAAIC,iBAAiB;YACvCC,QAAQL,UAAUM,EAAE;YACpBd,UAAUQ,UAAUR,QAAQ;YAC5BC,WAAWO,UAAUP,SAAS;YAC9BC,UAAUM,UAAUN,QAAQ;YAC5BC,OAAOK,UAAUL,KAAK;YACtBG,MAAME,UAAUF,IAAI;YACpBS,WAAWP,UAAUO,SAAS;QAClC;QAEA,kCAAkC;QAClC,IAAI,CAACL,QAAQ,CAACC,OAAO,CAAC,IAAIK,cAAc;YACpChB,UAAUQ,UAAUR,QAAQ;YAC5Ba,QAAQL,UAAUM,EAAE;YACpBG,QAAQ;YACRC,YAAY;YACZC,UAAUX,UAAUM,EAAE;YACtBM,WAAWZ;YACXa,WAAW,IAAIC;QACnB;QAEA,OAAOd;IACX;IA5CA,YACI,AACiBV,cAAgC,EACjD,AAAiBY,QAAkB,CACrC;aAFmBZ,iBAAAA;aACAY,WAAAA;IAClB;AAyCP"}