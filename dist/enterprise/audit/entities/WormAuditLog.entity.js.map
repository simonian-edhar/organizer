{"version":3,"sources":["../../../../src/enterprise/audit/entities/WormAuditLog.entity.ts"],"sourcesContent":["import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, Index, ManyToOne, JoinColumn } from 'typeorm';\nimport { Organization } from '../../../database/entities/Organization.entity';\nimport { User } from '../../../database/entities/User.entity';\nimport { AuditActionType } from '../interfaces/worm-audit.interface';\n\n@Entity('worm_audit_logs')\n@Index('idx_worm_audit_tenant_id', ['tenantId'])\n@Index('idx_worm_audit_user_id', ['userId'])\n@Index('idx_worm_audit_action', ['action'])\n@Index('idx_worm_audit_entity', ['entityType', 'entityId'])\n@Index('idx_worm_audit_timestamp', ['timestamp'])\n@Index('idx_worm_audit_tenant_timestamp', ['tenantId', 'timestamp'])\nexport class WormAuditLog {\n    @PrimaryGeneratedColumn('uuid')\n    id: string;\n\n    @Column({ name: 'tenant_id', type: 'uuid' })\n    tenantId: string;\n\n    @Column({ name: 'user_id', type: 'uuid', nullable: true })\n    userId: string;\n\n    @Column({\n        type: 'simple-enum',\n        enum: [\n            'create',\n            'update',\n            'delete',\n            'login',\n            'logout',\n            'login_failed',\n            'permission_change',\n            'role_change',\n            'password_change',\n            'mfa_enabled',\n            'mfa_disabled',\n            'export',\n            'download',\n            'share',\n            'api_key_create',\n            'api_key_revoke',\n            'settings_change',\n            'subscription_change',\n            'user_invite',\n            'user_remove',\n        ] as AuditActionType[],\n    })\n    action: AuditActionType;\n\n    @Column({ name: 'entity_type', type: 'varchar', length: 100 })\n    entityType: string;\n\n    @Column({ name: 'entity_id', type: 'uuid', nullable: true })\n    entityId: string;\n\n    @Column({ name: 'old_values', type: 'json', nullable: true })\n    oldValues: Record<string, any>;\n\n    @Column({ name: 'new_values', type: 'json', nullable: true })\n    newValues: Record<string, any>;\n\n    @Column({ name: 'changed_fields', type: 'json', nullable: true })\n    changedFields: string[];\n\n    // Request context\n    @Column({ name: 'ip_address', type: 'varchar', length: 45, nullable: true })\n    ipAddress: string;\n\n    @Column({ name: 'user_agent', type: 'text', nullable: true })\n    userAgent: string;\n\n    @Column({ name: 'request_id', type: 'varchar', length: 100, nullable: true })\n    requestId: string;\n\n    @Column({ name: 'session_id', type: 'varchar', length: 100, nullable: true })\n    sessionId: string;\n\n    @Column({ type: 'json' })\n    metadata: Record<string, any>;\n\n    @Column({ type: 'datetime' })\n    timestamp: Date;\n\n    // Integrity protection\n    @Column({ type: 'varchar', length: 128 })\n    hash: string;\n\n    @Column({ name: 'previous_hash', type: 'varchar', length: 128, nullable: true })\n    previousHash: string;\n\n    @Column({ name: 'chain_index', type: 'bigint' })\n    chainIndex: number;\n\n    @CreateDateColumn({ name: 'created_at', type: 'datetime' })\n    createdAt: Date;\n\n    // Relations\n    @ManyToOne(() => Organization, { onDelete: 'CASCADE' })\n    @JoinColumn({ name: 'tenant_id' })\n    organization: Organization;\n\n    @ManyToOne(() => User)\n    @JoinColumn({ name: 'user_id' })\n    user: User;\n}\n"],"names":["WormAuditLog","name","type","nullable","enum","length","Organization","onDelete","User"],"mappings":";;;;+BAYaA;;;eAAAA;;;yBAZ0F;oCAC1E;4BACR;oCACW;;;;;;;;;;AASzB,IAAA,AAAMA,eAAN,MAAMA;AA4Fb;;;;;;;QAxFcC,MAAM;QAAaC,MAAM;;;;;;QAGzBD,MAAM;QAAWC,MAAM;QAAQC,UAAU;;;;;;QAI/CD,MAAM;QACNE,MAAM;YACF;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACH;;;;;;QAIKH,MAAM;QAAeC,MAAM;QAAWG,QAAQ;;;;;;QAG9CJ,MAAM;QAAaC,MAAM;QAAQC,UAAU;;;;;;QAG3CF,MAAM;QAAcC,MAAM;QAAQC,UAAU;;;;;;QAG5CF,MAAM;QAAcC,MAAM;QAAQC,UAAU;;;;;;QAG5CF,MAAM;QAAkBC,MAAM;QAAQC,UAAU;;;;;;QAIhDF,MAAM;QAAcC,MAAM;QAAWG,QAAQ;QAAIF,UAAU;;;;;;QAG3DF,MAAM;QAAcC,MAAM;QAAQC,UAAU;;;;;;QAG5CF,MAAM;QAAcC,MAAM;QAAWG,QAAQ;QAAKF,UAAU;;;;;;QAG5DF,MAAM;QAAcC,MAAM;QAAWG,QAAQ;QAAKF,UAAU;;;;;;QAG5DD,MAAM;;;;;;QAGNA,MAAM;;;;;;QAINA,MAAM;QAAWG,QAAQ;;;;;;QAGzBJ,MAAM;QAAiBC,MAAM;QAAWG,QAAQ;QAAKF,UAAU;;;;;;QAG/DF,MAAM;QAAeC,MAAM;;;;;;QAGjBD,MAAM;QAAcC,MAAM;;;;;gCAI7BI,gCAAY;QAAIC,UAAU;;;QAC7BN,MAAM;;;;;gCAGHO,gBAAI;;QACPP,MAAM;;;;;;;QAhGY;;;QACF;;;QACD;;;QACA;QAAc;;;QACX;;;QACO;QAAY"}