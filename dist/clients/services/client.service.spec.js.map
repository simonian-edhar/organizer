{"version":3,"sources":["../../../src/clients/services/client.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { NotFoundException, ForbiddenException } from '@nestjs/common';\nimport { ClientService } from './client.service';\nimport { Client } from '../../database/entities/Client.entity';\nimport * as validationUtil from '../../common/utils/validation.util';\n\n// Mock validation utilities\njest.mock('../../common/utils/validation.util');\n\ndescribe('ClientService', () => {\n    let service: ClientService;\n    let clientRepository: jest.Mocked<Repository<Client>>;\n\n    const mockTenantId = 'test-tenant-id';\n    const mockUserId = 'test-user-id';\n    const mockClientId = 'test-client-id';\n\n    const mockClient: Client = {\n        id: mockClientId,\n        tenantId: mockTenantId,\n        type: 'individual',\n        firstName: 'Іван',\n        lastName: 'Петренко',\n        patronymic: 'Іванович',\n        email: 'ivan@example.com',\n        phone: '+380501234567',\n        status: 'active',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        deletedAt: null,\n        createdBy: mockUserId,\n        updatedBy: mockUserId,\n    } as Client;\n\n    const mockQueryBuilder = {\n        where: jest.fn().mockReturnThis(),\n        andWhere: jest.fn().mockReturnThis(),\n        orderBy: jest.fn().mockReturnThis(),\n        skip: jest.fn().mockReturnThis(),\n        take: jest.fn().mockReturnThis(),\n        leftJoinAndSelect: jest.fn().mockReturnThis(),\n        getManyAndCount: jest.fn(),\n        select: jest.fn().mockReturnThis(),\n        getRawMany: jest.fn(),\n    };\n\n    beforeEach(async () => {\n        const module: TestingModule = await Test.createTestingModule({\n            providers: [\n                ClientService,\n                {\n                    provide: getRepositoryToken(Client),\n                    useValue: {\n                        findOne: jest.fn(),\n                        create: jest.fn(),\n                        save: jest.fn(),\n                        update: jest.fn(),\n                        createQueryBuilder: jest.fn().mockReturnValue(mockQueryBuilder),\n                    },\n                },\n            ],\n        }).compile();\n\n        service = module.get<ClientService>(ClientService);\n        clientRepository = module.get(getRepositoryToken(Client));\n\n        // Reset mock query builder\n        Object.keys(mockQueryBuilder).forEach(key => {\n            mockQueryBuilder[key].mockClear();\n        });\n        mockQueryBuilder.where.mockReturnThis();\n        mockQueryBuilder.andWhere.mockReturnThis();\n        mockQueryBuilder.orderBy.mockReturnThis();\n        mockQueryBuilder.skip.mockReturnThis();\n        mockQueryBuilder.take.mockReturnThis();\n        mockQueryBuilder.leftJoinAndSelect.mockReturnThis();\n        mockQueryBuilder.select.mockReturnThis();\n    });\n\n    afterEach(() => {\n        jest.clearAllMocks();\n    });\n\n    describe('findAll', () => {\n        it('should return paginated clients', async () => {\n            const mockClients = [mockClient];\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([mockClients, 1]);\n\n            const result = await service.findAll(mockTenantId, {});\n\n            expect(result.data).toEqual(mockClients);\n            expect(result.total).toBe(1);\n            expect(result.page).toBe(1);\n            expect(result.limit).toBe(20);\n        });\n\n        it('should apply search filter', async () => {\n            (validationUtil.detectSqlInjection as jest.Mock).mockReturnValue(false);\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { search: 'Іван' });\n\n            expect(mockQueryBuilder.andWhere).toHaveBeenCalledWith(\n                expect.stringContaining('client.firstName ILIKE'),\n                { search: '%Іван%' }\n            );\n        });\n\n        it('should throw ForbiddenException for SQL injection attempt', async () => {\n            (validationUtil.detectSqlInjection as jest.Mock).mockReturnValue(true);\n\n            await expect(service.findAll(mockTenantId, { search: \"'; DROP TABLE clients; --\" }))\n                .rejects.toThrow(ForbiddenException);\n        });\n\n        it('should apply type filter', async () => {\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { type: 'individual' });\n\n            expect(mockQueryBuilder.andWhere).toHaveBeenCalledWith(\n                'client.type = :type',\n                { type: 'individual' }\n            );\n        });\n\n        it('should apply status filter', async () => {\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { status: 'active' });\n\n            expect(mockQueryBuilder.andWhere).toHaveBeenCalledWith(\n                'client.status = :status',\n                { status: 'active' }\n            );\n        });\n\n        it('should apply assigned user filter', async () => {\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { assignedUserId: mockUserId });\n\n            expect(mockQueryBuilder.andWhere).toHaveBeenCalledWith(\n                'client.assignedUserId = :assignedUserId',\n                { assignedUserId: mockUserId }\n            );\n        });\n\n        it('should apply pagination', async () => {\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { page: 2, limit: 10 });\n\n            expect(mockQueryBuilder.skip).toHaveBeenCalledWith(10);\n            expect(mockQueryBuilder.take).toHaveBeenCalledWith(10);\n        });\n\n        it('should apply sorting', async () => {\n            mockQueryBuilder.getManyAndCount.mockResolvedValue([[], 0]);\n\n            await service.findAll(mockTenantId, { sortBy: 'lastName', sortOrder: 'ASC' });\n\n            expect(mockQueryBuilder.orderBy).toHaveBeenCalledWith('client.lastName', 'ASC');\n        });\n    });\n\n    describe('findById', () => {\n        it('should return client by ID', async () => {\n            clientRepository.findOne.mockResolvedValue(mockClient);\n\n            const result = await service.findById(mockTenantId, mockClientId);\n\n            expect(result).toEqual(mockClient);\n            expect(clientRepository.findOne).toHaveBeenCalledWith({\n                where: {\n                    id: mockClientId,\n                    tenantId: mockTenantId,\n                    deletedAt: null,\n                },\n                relations: ['assignedUser', 'cases'],\n            });\n        });\n\n        it('should throw NotFoundException for non-existent client', async () => {\n            clientRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.findById(mockTenantId, mockClientId))\n                .rejects.toThrow(NotFoundException);\n        });\n    });\n\n    describe('create', () => {\n        const createDto = {\n            type: 'individual' as const,\n            firstName: 'Іван',\n            lastName: 'Петренко',\n            email: 'ivan@example.com',\n            phone: '+380501234567',\n        };\n\n        beforeEach(() => {\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(true);\n            (validationUtil.validateTaxNumber as jest.Mock).mockReturnValue(true);\n        });\n\n        it('should create a new client', async () => {\n            clientRepository.create.mockReturnValue(mockClient);\n            clientRepository.save.mockResolvedValue(mockClient);\n\n            const result = await service.create(mockTenantId, mockUserId, createDto);\n\n            expect(result).toEqual(mockClient);\n            expect(clientRepository.create).toHaveBeenCalledWith({\n                tenantId: mockTenantId,\n                ...createDto,\n                createdBy: mockUserId,\n                updatedBy: mockUserId,\n            });\n        });\n\n        it('should throw ForbiddenException for invalid EDRPOU', async () => {\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(false);\n\n            await expect(service.create(mockTenantId, mockUserId, {\n                ...createDto,\n                edrpou: 'invalid',\n            })).rejects.toThrow(ForbiddenException);\n        });\n\n        it('should throw ForbiddenException for invalid INN', async () => {\n            (validationUtil.validateTaxNumber as jest.Mock).mockReturnValue(false);\n\n            await expect(service.create(mockTenantId, mockUserId, {\n                ...createDto,\n                inn: 'invalid',\n            })).rejects.toThrow(ForbiddenException);\n        });\n\n        it('should create legal entity client', async () => {\n            const legalEntityDto = {\n                type: 'legal_entity' as const,\n                companyName: 'ТОВ \"Тест\"',\n                edrpou: '12345678',\n                email: 'test@company.com',\n            };\n            const mockLegalClient = { ...mockClient, type: 'legal_entity', ...legalEntityDto };\n            clientRepository.create.mockReturnValue(mockLegalClient);\n            clientRepository.save.mockResolvedValue(mockLegalClient);\n\n            const result = await service.create(mockTenantId, mockUserId, legalEntityDto);\n\n            expect(result.type).toBe('legal_entity');\n        });\n    });\n\n    describe('update', () => {\n        const updateDto = {\n            firstName: 'Петро',\n            lastName: 'Іваненко',\n        };\n\n        beforeEach(() => {\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(true);\n            (validationUtil.validateTaxNumber as jest.Mock).mockReturnValue(true);\n        });\n\n        it('should update existing client', async () => {\n            clientRepository.findOne.mockResolvedValue(mockClient);\n            clientRepository.save.mockResolvedValue({ ...mockClient, ...updateDto });\n\n            const result = await service.update(mockTenantId, mockClientId, mockUserId, updateDto);\n\n            expect(result.firstName).toBe('Петро');\n            expect(result.lastName).toBe('Іваненко');\n        });\n\n        it('should throw NotFoundException for non-existent client', async () => {\n            clientRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.update(mockTenantId, mockClientId, mockUserId, updateDto))\n                .rejects.toThrow(NotFoundException);\n        });\n\n        it('should throw ForbiddenException for invalid EDRPOU', async () => {\n            clientRepository.findOne.mockResolvedValue(mockClient);\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(false);\n\n            await expect(service.update(mockTenantId, mockClientId, mockUserId, {\n                edrpou: 'invalid',\n            })).rejects.toThrow(ForbiddenException);\n        });\n\n        it('should update client status', async () => {\n            clientRepository.findOne.mockResolvedValue(mockClient);\n            clientRepository.save.mockResolvedValue({ ...mockClient, status: 'inactive' });\n\n            const result = await service.update(mockTenantId, mockClientId, mockUserId, {\n                status: 'inactive',\n            });\n\n            expect(result.status).toBe('inactive');\n        });\n    });\n\n    describe('delete', () => {\n        it('should soft delete client', async () => {\n            clientRepository.findOne.mockResolvedValue(mockClient);\n            clientRepository.update.mockResolvedValue({} as any);\n\n            await service.delete(mockTenantId, mockClientId, mockUserId);\n\n            expect(clientRepository.update).toHaveBeenCalledWith(\n                { id: mockClientId, tenantId: mockTenantId },\n                {\n                    deletedAt: expect.any(Date),\n                    updatedBy: mockUserId,\n                }\n            );\n        });\n\n        it('should throw NotFoundException for non-existent client', async () => {\n            clientRepository.findOne.mockResolvedValue(null);\n\n            await expect(service.delete(mockTenantId, mockClientId, mockUserId))\n                .rejects.toThrow(NotFoundException);\n        });\n    });\n\n    describe('restore', () => {\n        it('should restore deleted client', async () => {\n            clientRepository.update.mockResolvedValue({} as any);\n            clientRepository.findOne.mockResolvedValue(mockClient);\n\n            const result = await service.restore(mockTenantId, mockClientId, mockUserId);\n\n            expect(clientRepository.update).toHaveBeenCalledWith(\n                { id: mockClientId, tenantId: mockTenantId },\n                {\n                    deletedAt: null,\n                    updatedBy: mockUserId,\n                }\n            );\n            expect(result).toEqual(mockClient);\n        });\n    });\n\n    describe('bulkImport', () => {\n        const clientsToImport = [\n            { type: 'individual' as const, firstName: 'Іван', lastName: 'Петренко' },\n            { type: 'individual' as const, firstName: 'Петро', lastName: 'Іваненко' },\n        ];\n\n        beforeEach(() => {\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(true);\n            (validationUtil.validateTaxNumber as jest.Mock).mockReturnValue(true);\n        });\n\n        it('should import multiple clients successfully', async () => {\n            clientRepository.create.mockReturnValue(mockClient);\n            clientRepository.save.mockResolvedValue(mockClient);\n\n            const result = await service.bulkImport(mockTenantId, mockUserId, clientsToImport);\n\n            expect(result.success).toBe(2);\n            expect(result.failed).toBe(0);\n            expect(result.errors).toHaveLength(0);\n        });\n\n        it('should handle partial failures', async () => {\n            clientRepository.create.mockReturnValue(mockClient);\n            clientRepository.save\n                .mockResolvedValueOnce(mockClient)\n                .mockRejectedValueOnce(new Error('Database error'));\n\n            const result = await service.bulkImport(mockTenantId, mockUserId, clientsToImport);\n\n            expect(result.success).toBe(1);\n            expect(result.failed).toBe(1);\n            expect(result.errors).toHaveLength(1);\n        });\n\n        it('should handle validation errors', async () => {\n            const invalidClients = [\n                { type: 'legal_entity' as const, edrpou: 'invalid' },\n            ];\n            (validationUtil.validateEdrpou as jest.Mock).mockReturnValue(false);\n\n            const result = await service.bulkImport(mockTenantId, mockUserId, invalidClients);\n\n            expect(result.success).toBe(0);\n            expect(result.failed).toBe(1);\n        });\n    });\n\n    describe('getStatistics', () => {\n        it('should return client statistics', async () => {\n            mockQueryBuilder.getRawMany\n                .mockResolvedValueOnce([{ count: '100' }])\n                .mockResolvedValueOnce([{ count: '80' }])\n                .mockResolvedValueOnce([{ count: '15' }])\n                .mockResolvedValueOnce([{ count: '60' }])\n                .mockResolvedValueOnce([{ count: '40' }]);\n\n            const result = await service.getStatistics(mockTenantId);\n\n            expect(result).toEqual({\n                total: 100,\n                active: 80,\n                inactive: 15,\n                individuals: 60,\n                legalEntities: 40,\n            });\n        });\n\n        it('should handle empty statistics', async () => {\n            mockQueryBuilder.getRawMany\n                .mockResolvedValueOnce([{ count: '0' }])\n                .mockResolvedValueOnce([{ count: '0' }])\n                .mockResolvedValueOnce([{ count: '0' }])\n                .mockResolvedValueOnce([{ count: '0' }])\n                .mockResolvedValueOnce([{ count: '0' }]);\n\n            const result = await service.getStatistics(mockTenantId);\n\n            expect(result.total).toBe(0);\n        });\n    });\n});\n"],"names":["jest","mock","describe","service","clientRepository","mockTenantId","mockUserId","mockClientId","mockClient","id","tenantId","type","firstName","lastName","patronymic","email","phone","status","createdAt","Date","updatedAt","deletedAt","createdBy","updatedBy","mockQueryBuilder","where","fn","mockReturnThis","andWhere","orderBy","skip","take","leftJoinAndSelect","getManyAndCount","select","getRawMany","beforeEach","module","Test","createTestingModule","providers","ClientService","provide","getRepositoryToken","Client","useValue","findOne","create","save","update","createQueryBuilder","mockReturnValue","compile","get","Object","keys","forEach","key","mockClear","afterEach","clearAllMocks","it","mockClients","mockResolvedValue","result","findAll","expect","data","toEqual","total","toBe","page","limit","validationUtil","detectSqlInjection","search","toHaveBeenCalledWith","stringContaining","rejects","toThrow","ForbiddenException","assignedUserId","sortBy","sortOrder","findById","relations","NotFoundException","createDto","validateEdrpou","validateTaxNumber","edrpou","inn","legalEntityDto","companyName","mockLegalClient","updateDto","delete","any","restore","clientsToImport","bulkImport","success","failed","errors","toHaveLength","mockResolvedValueOnce","mockRejectedValueOnce","Error","invalidClients","count","getStatistics","active","inactive","individuals","legalEntities"],"mappings":"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"}