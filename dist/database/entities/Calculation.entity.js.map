{"version":3,"sources":["../../../src/database/entities/Calculation.entity.ts"],"sourcesContent":["import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn, DeleteDateColumn, ManyToOne, JoinColumn, OneToMany, Index } from 'typeorm';\nimport { Case } from './Case.entity';\nimport { User } from './User.entity';\n\n\n/**\n * Calculation Status\n */\nexport type CalculationStatus = 'draft' | 'pending_approval' | 'approved' | 'rejected' | 'paid';\n\n/**\n * Calculation Entity\n * Represents a billing calculation for a case\n */\n@Entity('calculations')\n@Index('idx_calculations_tenant_id', ['tenantId'])\n@Index('idx_calculations_case_id', ['caseId'])\n@Index('idx_calculations_status', ['status'])\n@Index('idx_calculations_date', ['calculationDate'])\nexport class Calculation {\n    @PrimaryGeneratedColumn('uuid')\n    id: string;\n\n    @Column({ name: 'tenant_id', type: 'uuid' })\n    tenantId: string;\n\n    // Case Reference\n    @Column({ name: 'case_id', type: 'uuid', nullable: true })\n    caseId: string;\n\n    // Calculation Details\n    @Column({ type: 'varchar', length: 50 })\n    number: string; // Invoice/Calculation number\n\n    @Column({ type: 'text', nullable: true })\n    description: string;\n\n    @Column({ name: 'calculation_date', type: 'date' })\n    calculationDate: Date;\n\n    @Column({ name: 'due_date', type: 'date', nullable: true })\n    dueDate: Date;\n\n    @Column({ name: 'paid_date', type: 'date', nullable: true })\n    paidDate: Date;\n\n    // Amounts\n    @Column({ name: 'subtotal', type: 'decimal', precision: 14, scale: 2, nullable: true })\n    subtotal: number;\n\n    @Column({ name: 'discount_amount', type: 'decimal', precision: 14, scale: 2, default: 0 })\n    discountAmount: number;\n\n    @Column({ name: 'vat_amount', type: 'decimal', precision: 14, scale: 2, default: 0 })\n    vatAmount: number;\n\n    @Column({ name: 'total_amount', type: 'decimal', precision: 14, scale: 2, nullable: true })\n    totalAmount: number;\n\n    @Column({ name: 'paid_amount', type: 'decimal', precision: 14, scale: 2, default: 0 })\n    paidAmount: number;\n\n    @Column({ name: 'currency', type: 'varchar', length: 3, default: 'UAH' })\n    currency: string;\n\n    // Status\n    @Column({\n        type: 'varchar',\n        default: 'draft'\n    })\n    status: CalculationStatus;\n\n    // Pricelist Reference\n    @Column({ name: 'pricelist_id', type: 'uuid', nullable: true })\n    pricelistId: string;\n\n    // Notes\n    @Column({ type: 'text', nullable: true })\n    internalNotes: string;\n\n    @Column({ type: 'text', nullable: true })\n    clientNotes: string;\n\n    // Metadata\n    @Column({ type: 'json' })\n    metadata: Record<string, any>;\n\n    // Soft Delete\n    @DeleteDateColumn({ name: 'deleted_at', type: 'datetime' })\n    deletedAt: Date;\n\n    // Timestamps\n    @CreateDateColumn({ name: 'created_at', type: 'datetime' })\n    createdAt: Date;\n\n    @UpdateDateColumn({ name: 'updated_at', type: 'datetime' })\n    updatedAt: Date;\n\n    @Column({ name: 'created_by', type: 'uuid', nullable: true })\n    createdBy: string;\n\n    @Column({ name: 'updated_by', type: 'uuid', nullable: true })\n    updatedBy: string;\n\n    // Relations\n    @ManyToOne(() => Case)\n    @JoinColumn({ name: 'case_id' })\n    case: Case;\n\n    @ManyToOne(() => User, { nullable: true })\n    @JoinColumn({ name: 'approved_by' })\n    approvedBy: User;\n\n    @OneToMany(() => require('./CalculationItem.entity').CalculationItem, (item) => item.calculation)\n    items: CalculationItem[];\n}\n"],"names":["Calculation","name","type","nullable","length","precision","scale","default","Case","User","require","CalculationItem","item","calculation"],"mappings":";;;;+BAmBaA;;;eAAAA;;;yBAnByI;4BACjI;4BACA;;;;;;;;;;AAiBd,IAAA,AAAMA,cAAN,MAAMA;AAgGb;;;;;;;QA5FcC,MAAM;QAAaC,MAAM;;;;;;QAIzBD,MAAM;QAAWC,MAAM;QAAQC,UAAU;;;;;;QAIzCD,MAAM;QAAWE,QAAQ;;;;;;QAGzBF,MAAM;QAAQC,UAAU;;;;;;QAGxBF,MAAM;QAAoBC,MAAM;;;;;;QAGhCD,MAAM;QAAYC,MAAM;QAAQC,UAAU;;;;;;QAG1CF,MAAM;QAAaC,MAAM;QAAQC,UAAU;;;;;;QAI3CF,MAAM;QAAYC,MAAM;QAAWG,WAAW;QAAIC,OAAO;QAAGH,UAAU;;;;;;QAGtEF,MAAM;QAAmBC,MAAM;QAAWG,WAAW;QAAIC,OAAO;QAAGC,SAAS;;;;;;QAG5EN,MAAM;QAAcC,MAAM;QAAWG,WAAW;QAAIC,OAAO;QAAGC,SAAS;;;;;;QAGvEN,MAAM;QAAgBC,MAAM;QAAWG,WAAW;QAAIC,OAAO;QAAGH,UAAU;;;;;;QAG1EF,MAAM;QAAeC,MAAM;QAAWG,WAAW;QAAIC,OAAO;QAAGC,SAAS;;;;;;QAGxEN,MAAM;QAAYC,MAAM;QAAWE,QAAQ;QAAGG,SAAS;;;;;;QAK7DL,MAAM;QACNK,SAAS;;;;;;QAKHN,MAAM;QAAgBC,MAAM;QAAQC,UAAU;;;;;;QAI9CD,MAAM;QAAQC,UAAU;;;;;;QAGxBD,MAAM;QAAQC,UAAU;;;;;;QAIxBD,MAAM;;;;;;QAIID,MAAM;QAAcC,MAAM;;;;;;QAI1BD,MAAM;QAAcC,MAAM;;;;;;QAG1BD,MAAM;QAAcC,MAAM;;;;;;QAGpCD,MAAM;QAAcC,MAAM;QAAQC,UAAU;;;;;;QAG5CF,MAAM;QAAcC,MAAM;QAAQC,UAAU;;;;;gCAIrCK,gBAAI;;QACPP,MAAM;;;;;gCAGHQ,gBAAI;QAAIN,UAAU;;;QACrBF,MAAM;;;;;gCAGHS,QAAQ,4BAA4BC,eAAe,GAAGC,OAASA,KAAKC,WAAW;;;;;;QAlG9D;;;QACF;;;QACD;;;QACF"}